# æ¨èå¡ç‰‡åŠŸèƒ½ V2 æµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤å’Œç¤ºä¾‹ï¼Œå¸®åŠ©éªŒè¯æ¨èå¡ç‰‡åŠŸèƒ½çš„æ–°å®ç°ã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡

- âœ… éªŒè¯æ–°çš„è½»é‡çº§æ¨èå·¥å…·èƒ½æ­£ç¡®è¿”å›IDåˆ—è¡¨
- âœ… éªŒè¯åç«¯èƒ½æ‰¹é‡è·å–å¹¶ç»„è£…å¡ç‰‡æ•°æ®
- âœ… éªŒè¯æµå¼æ¥å£èƒ½æ­£ç¡®æ¨é€å¡ç‰‡æ•°æ®äº‹ä»¶
- âœ… éªŒè¯Tokenæ¶ˆè€—é™ä½åˆ°é¢„æœŸæ°´å¹³ï¼ˆ~500 tokensï¼‰
- âœ… éªŒè¯å“åº”é€Ÿåº¦æå‡åˆ°é¢„æœŸæ°´å¹³ï¼ˆ3-5ç§’ï¼‰

## ğŸš€ æµ‹è¯•å‰å‡†å¤‡

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
cd e:\5plus1\DEV\zytb\zy_backend
npm run dev
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸš€ æœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£ 3000
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ“‹ å·²æ³¨å†Œå·¥å…·æ•°é‡: X
```

### 2. å‡†å¤‡æµ‹è¯•ç”¨æˆ·

ç¡®ä¿æ•°æ®åº“ä¸­æœ‰æµ‹è¯•ç”¨æˆ·ï¼Œæˆ–ä½¿ç”¨ä»¥ä¸‹è„šæœ¬åˆ›å»ºï¼š

```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user_001",
    "password": "Test123456",
    "phone": "13800138000",
    "idCard": "320100199001011234"
  }'
```

### 3. ç™»å½•è·å– Token

```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user_001",
    "password": "Test123456"
  }'
```

ä¿å­˜è¿”å›çš„ `token` ç”¨äºåç»­è¯·æ±‚ã€‚

## ğŸ“ æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: åŸºæœ¬æ¨èæµç¨‹ï¼ˆæµå¼æ¥å£ï¼‰

**ç›®çš„**: éªŒè¯å®Œæ•´çš„æ¨èæµç¨‹ï¼ŒåŒ…æ‹¬IDè¿”å›å’Œå¡ç‰‡æ•°æ®æ¨é€

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:3000/api/ai/chat-stream \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "message": "æˆ‘æ˜¯æ±Ÿè‹è€ƒç”Ÿï¼Œç‰©ç†ç±»ï¼Œé«˜è€ƒåˆ†æ•°650åˆ†ï¼Œä½æ¬¡1200åï¼Œæˆ‘æƒ³å­¦è®¡ç®—æœºä¸“ä¸š",
    "userId": "test_user_001"
  }'
```

**é¢„æœŸå“åº”æµ**:

```
data: {"type":"session","sessionId":"xxx-xxx-xxx"}

data: {"type":"content","content":"æ­£åœ¨ä¸ºæ‚¨"}

data: {"type":"content","content":"æŸ¥è¯¢æ¨è"}

data: {"type":"content","content":"..."}

data: {"type":"content","content":"ğŸ” æ­£åœ¨æŸ¥è¯¢æ•°æ®...\n\n"}

data: {"type":"content","content":"âœ“ get_recommendation_ids æ‰§è¡Œå®Œæˆ\n"}

data: {"type":"content","content":"æˆ‘ä¸ºæ‚¨æ‰¾åˆ°äº†40ä¸ªæ¨è"}

data: {"type":"content","content":"ï¼ŒåŒ…æ‹¬12ä¸ªå†²ä¸€å†²"}

data: {"type":"content","content":"ã€20ä¸ªç¨³ä¸€ç¨³"}

data: {"type":"content","content":"ã€8ä¸ªä¿ä¸€ä¿ã€‚"}

data: {"type":"content","content":"\n\nğŸ“¦ æ­£åœ¨åŠ è½½æ¨èè¯¦æƒ…...\n\n"}

data: {"type":"recommendation_cards","data":{"rush":[...],"stable":[...],"safe":[...]},"summary":{...}}

data: {"type":"done","success":true,"message":"...","conversationHistory":[...]}
```

**éªŒè¯ç‚¹**:
- âœ… ç¬¬ä¸€æ­¥ï¼šAIè°ƒç”¨ `get_recommendation_ids` å·¥å…·
- âœ… ç¬¬äºŒæ­¥ï¼šAIå‘ç”¨æˆ·è¯´æ˜æ¨èæ¦‚å†µï¼ˆæ€»æ•°ã€åˆ†å¸ƒï¼‰
- âœ… ç¬¬ä¸‰æ­¥ï¼šå‡ºç° "ğŸ“¦ æ­£åœ¨åŠ è½½æ¨èè¯¦æƒ…..." æç¤º
- âœ… ç¬¬å››æ­¥ï¼šæ¨é€ `type: "recommendation_cards"` äº‹ä»¶
- âœ… ç¬¬äº”æ­¥ï¼šäº‹ä»¶åŒ…å«å®Œæ•´çš„ `rush`ã€`stable`ã€`safe` æ•°ç»„
- âœ… æ¯ä¸ªå¡ç‰‡åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µï¼ˆè§ä¸‹æ–¹å­—æ®µæ¸…å•ï¼‰

### åœºæ™¯ 2: å¸¦åå¥½çš„æ¨è

**ç›®çš„**: éªŒè¯ç”¨æˆ·åå¥½èƒ½æ­£ç¡®ä¼ é€’å¹¶ç”Ÿæ•ˆ

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:3000/api/ai/chat-stream \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "message": "æˆ‘æ˜¯æ±Ÿè‹è€ƒç”Ÿï¼Œç‰©ç†ç±»ï¼Œé«˜è€ƒåˆ†æ•°620åˆ†ï¼Œä½æ¬¡3500åï¼Œæˆ‘æƒ³è¦æ±Ÿè‹çœå†…çš„985æˆ–211å¤§å­¦ï¼Œä¸“ä¸šåå¥½è®¡ç®—æœºç±»å’Œç”µå­ä¿¡æ¯ç±»",
    "userId": "test_user_001"
  }'
```

**é¢„æœŸ**:
- AIæå–åå¥½ï¼š`locations: ["æ±Ÿè‹"]`, `collegeTypes: ["985", "211"]`, `majorCategories: ["è®¡ç®—æœºç±»", "ç”µå­ä¿¡æ¯ç±»"]`
- è¿”å›çš„å¡ç‰‡åº”åªåŒ…å«æ±Ÿè‹çœå†…çš„985/211é™¢æ ¡
- ä¸“ä¸šåº”ä¸»è¦ä¸ºè®¡ç®—æœºç±»å’Œç”µå­ä¿¡æ¯ç±»

**éªŒè¯ç‚¹**:
- âœ… æ¨èç»“æœä¸­æ‰€æœ‰é™¢æ ¡ `collegeProvince` ä¸º "æ±Ÿè‹"
- âœ… æ¨èç»“æœä¸­æ‰€æœ‰é™¢æ ¡ `is985` æˆ– `is211` ä¸º `true`
- âœ… ä¸“ä¸šç»„ä¸­åŒ…å«è®¡ç®—æœºæˆ–ç”µå­ä¿¡æ¯ç›¸å…³ä¸“ä¸š

### åœºæ™¯ 3: éæµå¼æ¥å£

**ç›®çš„**: éªŒè¯æ™®é€šAPIæ¥å£ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:3000/api/ai/chat \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "message": "æˆ‘æ˜¯æ±Ÿè‹è€ƒç”Ÿï¼Œç‰©ç†ç±»ï¼Œé«˜è€ƒåˆ†æ•°600åˆ†ï¼Œä½æ¬¡8000åï¼Œå¸®æˆ‘æ¨èé€‚åˆçš„é™¢æ ¡",
    "userId": "test_user_001"
  }'
```

**é¢„æœŸ**:
- è¿”å›å®Œæ•´çš„å“åº”JSON
- `message` å­—æ®µåŒ…å«AIå›å¤å†…å®¹
- **æ³¨æ„**: éæµå¼æ¥å£å¯èƒ½ä¸æ”¯æŒå¡ç‰‡æ•°æ®æ¨é€ï¼ˆå¦‚éœ€æ”¯æŒéœ€é¢å¤–å¼€å‘ï¼‰

### åœºæ™¯ 4: æ€§èƒ½æµ‹è¯•

**ç›®çš„**: éªŒè¯Tokenæ¶ˆè€—å’Œå“åº”é€Ÿåº¦çš„æ”¹è¿›

**æµ‹è¯•æ–¹æ³•**:
1. è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
2. å‘é€æ¨èè¯·æ±‚
3. è®°å½•ç¬¬ä¸€ä¸ªå†…å®¹è¿”å›æ—¶é—´ï¼ˆé¦–å­—èŠ‚æ—¶é—´ï¼‰
4. è®°å½•å¡ç‰‡æ•°æ®è¿”å›æ—¶é—´
5. è®°å½•è¯·æ±‚ç»“æŸæ—¶é—´
6. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ä¸­çš„Tokenæ¶ˆè€—ä¿¡æ¯

**é¢„æœŸæ€§èƒ½æŒ‡æ ‡**:
- Tokenæ¶ˆè€—ï¼š~500 tokensï¼ˆvs æ—§ç‰ˆ~20,000 tokensï¼‰
- é¦–å­—èŠ‚æ—¶é—´ï¼š< 1ç§’
- å¡ç‰‡æ•°æ®è¿”å›æ—¶é—´ï¼š3-5ç§’ï¼ˆvs æ—§ç‰ˆ15-20ç§’ï¼‰
- æ€»å“åº”æ—¶é—´ï¼š< 8ç§’

**æœåŠ¡å™¨æ—¥å¿—éªŒè¯**:
```
ğŸ”§ è°ƒç”¨å·¥å…·: get_recommendation_ids
âœ… å·¥å…·æ‰§è¡Œå®Œæˆ: æˆåŠŸ
ğŸ“¦ å¼€å§‹è·å–æ¨èå¡ç‰‡æ•°æ®...
âœ… æˆåŠŸè·å– 40 ä¸ªå¡ç‰‡æ•°æ®
âœ… å¡ç‰‡æ•°æ®å·²æ¨é€ç»™å‰ç«¯
```

## ğŸ“Š å¡ç‰‡æ•°æ®éªŒè¯

### å¿…éœ€å­—æ®µæ¸…å•

æ¯ä¸ªå¡ç‰‡åº”åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```typescript
{
  // åŸºæœ¬ä¿¡æ¯ (å¿…å¡«)
  "groupId": string,              // âœ… æ ¼å¼: "collegeCode_groupCode"
  "collegeName": string,          // âœ… é™¢æ ¡åç§°
  "collegeCode": string,          // âœ… é™¢æ ¡ä»£ç 
  "collegeProvince": string,      // âœ… é™¢æ ¡æ‰€åœ¨çœä»½
  "groupName": string,            // âœ… ä¸“ä¸šç»„åç§°
  "groupCode": string,            // âœ… ä¸“ä¸šç»„ä»£ç 

  // é™¢æ ¡æ ‡ç­¾ (å¿…å¡«)
  "is985": boolean,               // âœ… æ˜¯å¦985
  "is211": boolean,               // âœ… æ˜¯å¦211
  "isDoubleFirstClass": boolean,  // âœ… æ˜¯å¦åŒä¸€æµ

  // å†²ç¨³ä¿åˆ†ç±» (å¿…å¡«)
  "riskLevel": "å†²"|"ç¨³"|"ä¿",    // âœ… é£é™©çº§åˆ«
  "probability": number,          // âœ… å½•å–æ¦‚ç‡ (0-100)
  "confidence": number,           // âœ… ç½®ä¿¡åº¦ (0-100)
  "adjustmentRisk": "é«˜"|"ä¸­"|"ä½", // âœ… è°ƒå‰‚é£é™©

  // åˆ†æ•°åˆ†æ (å¿…å¡«)
  "scoreGap": number,             // âœ… åˆ†æ•°å·®è·
  "rankGap": number|null,         // âœ… ä½æ¬¡å·®è·
  "userScore": number,            // âœ… ç”¨æˆ·åˆ†æ•°
  "userRank": number,             // âœ… ç”¨æˆ·ä½æ¬¡
  "avgMinScore": number,          // âœ… è¿‘3å¹´å¹³å‡æœ€ä½åˆ†
  "avgMinRank": number,           // âœ… è¿‘3å¹´å¹³å‡æœ€ä½ä½æ¬¡

  // å†å¹´æ•°æ® (å¿…å¡«)
  "historicalData": [             // âœ… æ•°ç»„ï¼Œè‡³å°‘1æ¡
    {
      "year": number,
      "minScore": number,
      "avgScore": number,
      "maxScore": number,
      "minRank": number,
      "maxRank": number,
      "planCount": number
    }
  ],
  "scoreVolatility": number,      // âœ… åˆ†æ•°æ³¢åŠ¨æ€§
  "scoreTrend": "up"|"down"|"stable", // âœ… åˆ†æ•°è¶‹åŠ¿

  // ä¸“ä¸šä¿¡æ¯ (å¿…å¡«)
  "majors": [                     // âœ… æ•°ç»„ï¼Œè‡³å°‘1ä¸ªä¸“ä¸š
    {
      "majorId": string,
      "majorName": string,
      "majorCode": string,
      "planCount": number,
      "tuition": number,
      "duration": string,
      "studyLocation": string,
      "remarks": string
    }
  ],
  "totalMajors": number,          // âœ… ä¸“ä¸šæ€»æ•°
  "totalPlanCount": number,       // âœ… æ€»æ‹›ç”Ÿè®¡åˆ’æ•°

  // æ¨èç†ç”± (å¿…å¡«)
  "recommendReasons": string[],   // âœ… æ•°ç»„ï¼Œè‡³å°‘1æ¡
  "warnings": string[],           // âœ… æ•°ç»„ï¼Œå¯ä¸ºç©º
  "highlights": string[],         // âœ… æ•°ç»„ï¼Œå¯ä¸ºç©º

  // æ’åºæƒé‡ (å¿…å¡«)
  "rankScore": number             // âœ… ç»¼åˆæ’åºåˆ†æ•°
}
```

### æ•°æ®è´¨é‡æ£€æŸ¥è„šæœ¬

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬éªŒè¯å¡ç‰‡æ•°æ®çš„å®Œæ•´æ€§ï¼š

```javascript
function validateCard(card) {
  const requiredFields = [
    'groupId', 'collegeName', 'collegeCode', 'collegeProvince',
    'groupName', 'groupCode', 'is985', 'is211', 'isDoubleFirstClass',
    'riskLevel', 'probability', 'confidence', 'adjustmentRisk',
    'scoreGap', 'userScore', 'userRank', 'avgMinScore', 'avgMinRank',
    'historicalData', 'scoreVolatility', 'scoreTrend',
    'majors', 'totalMajors', 'totalPlanCount',
    'recommendReasons', 'warnings', 'highlights', 'rankScore'
  ];

  const missing = requiredFields.filter(field => !(field in card));

  if (missing.length > 0) {
    console.error(`âŒ å¡ç‰‡ ${card.groupId} ç¼ºå°‘å­—æ®µ:`, missing);
    return false;
  }

  // éªŒè¯æ•°æ®ç±»å‹
  if (card.probability < 0 || card.probability > 100) {
    console.error(`âŒ å¡ç‰‡ ${card.groupId} çš„ probability è¶…å‡ºèŒƒå›´: ${card.probability}`);
    return false;
  }

  if (!Array.isArray(card.historicalData) || card.historicalData.length === 0) {
    console.error(`âŒ å¡ç‰‡ ${card.groupId} çš„ historicalData ä¸ºç©º`);
    return false;
  }

  if (!Array.isArray(card.majors) || card.majors.length === 0) {
    console.error(`âŒ å¡ç‰‡ ${card.groupId} çš„ majors ä¸ºç©º`);
    return false;
  }

  if (!Array.isArray(card.recommendReasons) || card.recommendReasons.length === 0) {
    console.error(`âŒ å¡ç‰‡ ${card.groupId} çš„ recommendReasons ä¸ºç©º`);
    return false;
  }

  console.log(`âœ… å¡ç‰‡ ${card.groupId} éªŒè¯é€šè¿‡`);
  return true;
}

// ä½¿ç”¨ç¤ºä¾‹
const cardsEvent = /* ä»å“åº”ä¸­è§£æçš„ recommendation_cards äº‹ä»¶ */;
cardsEvent.data.rush.forEach(validateCard);
cardsEvent.data.stable.forEach(validateCard);
cardsEvent.data.safe.forEach(validateCard);
```

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: æ²¡æœ‰æ¨é€ recommendation_cards äº‹ä»¶

**å¯èƒ½åŸå› **:
1. AIæ²¡æœ‰è°ƒç”¨ `get_recommendation_ids` å·¥å…·
2. å·¥å…·æ‰§è¡Œå¤±è´¥
3. å¡ç‰‡æ•°æ®è·å–å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ï¼ŒæŸ¥æ‰¾ `ğŸ”§ è°ƒç”¨å·¥å…·: get_recommendation_ids`
2. æ£€æŸ¥æ˜¯å¦æœ‰ `âœ… å·¥å…·æ‰§è¡Œå®Œæˆ: æˆåŠŸ`
3. æ£€æŸ¥æ˜¯å¦æœ‰ `ğŸ“¦ å¼€å§‹è·å–æ¨èå¡ç‰‡æ•°æ®...`
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`âŒ è·å–å¡ç‰‡æ•°æ®å¤±è´¥:`

**è§£å†³æ–¹æ³•**:
- å¦‚æœå·¥å…·æœªè¢«è°ƒç”¨ï¼šæ£€æŸ¥ç”¨æˆ·è¾“å…¥æ˜¯å¦åŒ…å«åˆ†æ•°ã€ä½æ¬¡ç­‰å¿…éœ€ä¿¡æ¯
- å¦‚æœå·¥å…·æ‰§è¡Œå¤±è´¥ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œæ•°æ®å®Œæ•´æ€§
- å¦‚æœå¡ç‰‡è·å–å¤±è´¥ï¼šæ£€æŸ¥ `RecommendationCardService` æ—¥å¿—

### é—®é¢˜ 2: å¡ç‰‡æ•°æ®ä¸å®Œæ•´

**å¯èƒ½åŸå› **:
1. æ•°æ®åº“ä¸­ç¼ºå°‘å†å²æ•°æ®
2. ä¸“ä¸šä¿¡æ¯æœªæ­£ç¡®èšåˆ
3. æ¦‚ç‡è®¡ç®—å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ `admission_scores` è¡¨æ˜¯å¦æœ‰å¯¹åº”é™¢æ ¡çš„å†å²æ•°æ®
2. æ£€æŸ¥ `enrollment_plans` è¡¨æ˜¯å¦æœ‰å¯¹åº”ä¸“ä¸šç»„çš„æ‹›ç”Ÿè®¡åˆ’
3. æ£€æŸ¥ `AdmissionProbabilityService.calculateForGroup()` çš„æ—¥å¿—

**è§£å†³æ–¹æ³•**:
- ç¡®ä¿æ•°æ®åº“ä¸­æœ‰è‡³å°‘3å¹´çš„å†å²æ•°æ®
- ç¡®ä¿ä¸“ä¸šç»„ä»£ç æ­£ç¡®ï¼ˆ`collegeCode_majorGroupCode`ï¼‰
- æ£€æŸ¥æ¦‚ç‡è®¡ç®—çš„å‚æ•°æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 3: Tokenæ¶ˆè€—ä»ç„¶å¾ˆé«˜

**å¯èƒ½åŸå› **:
1. AIè°ƒç”¨äº†æ—§çš„ `smart_recommendation` å·¥å…·
2. System prompt æœªæ­£ç¡®æ›´æ–°

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ï¼ŒæŸ¥æ‰¾è°ƒç”¨çš„å·¥å…·åç§°
2. æ£€æŸ¥ `agent.service.ts` çš„ system prompt æ˜¯å¦æ­£ç¡®æ ‡è®°æ–°å·¥å…·ä¸ºæ¨è

**è§£å†³æ–¹æ³•**:
- ç¡®è®¤ system prompt ä¸­ `get_recommendation_ids` æ ‡è®°ä¸º â­ æ¨èä½¿ç”¨
- ç¡®è®¤ `smart_recommendation` æ ‡è®°ä¸º æ—§ç‰ˆ/å‘åå…¼å®¹
- é‡å¯æœåŠ¡å™¨ç¡®ä¿æ›´æ–°ç”Ÿæ•ˆ

### é—®é¢˜ 4: å“åº”é€Ÿåº¦æ²¡æœ‰æå‡

**å¯èƒ½åŸå› **:
1. æ•°æ®åº“æŸ¥è¯¢æ²¡æœ‰ä½¿ç”¨æ‰¹é‡æ¨¡å¼
2. ç¼ºå°‘æ•°æ®åº“ç´¢å¼•
3. ç½‘ç»œå»¶è¿Ÿ

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ `RecommendationCardService` çš„æŸ¥è¯¢æ—¥å¿—
2. ä½¿ç”¨ `EXPLAIN` åˆ†æSQLæŸ¥è¯¢æ€§èƒ½
3. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† `IN` æ‰¹é‡æŸ¥è¯¢

**è§£å†³æ–¹æ³•**:
- ç¡®ä¿ä½¿ç”¨ `IN (:...ids)` è¿›è¡Œæ‰¹é‡æŸ¥è¯¢
- æ·»åŠ å¿…è¦çš„æ•°æ®åº“ç´¢å¼•ï¼ˆè§æ–‡æ¡£å»ºè®®ï¼‰
- è€ƒè™‘æ·»åŠ Redisç¼“å­˜ï¼ˆä¸­æœŸä¼˜åŒ–ï¼‰

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æµ‹è¯•

### æµ‹è¯•ç¯å¢ƒ

- æ•°æ®åº“ï¼šMySQL 8.0
- æœåŠ¡å™¨ï¼šNode.js 18.x
- æ•°æ®é‡ï¼šçº¦Xä¸‡æ¡æ‹›ç”Ÿè®¡åˆ’ + Xä¸‡æ¡å†å²åˆ†æ•°

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æ—§ç‰ˆå®é™…å€¼ | æ–°ç‰ˆå®é™…å€¼ |
|-----|-------|----------|----------|
| Tokenæ¶ˆè€— | ~500 | ~20,000 | _å¾…æµ‹è¯•_ |
| é¦–å­—èŠ‚æ—¶é—´ | < 1ç§’ | ~2ç§’ | _å¾…æµ‹è¯•_ |
| å¡ç‰‡æ•°æ®è¿”å› | 3-5ç§’ | 15-20ç§’ | _å¾…æµ‹è¯•_ |
| æ€»å“åº”æ—¶é—´ | < 8ç§’ | 20-25ç§’ | _å¾…æµ‹è¯•_ |
| æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° | 2-3æ¬¡ | 40+æ¬¡ | _å¾…æµ‹è¯•_ |

### æ€§èƒ½æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash

echo "å¼€å§‹æ€§èƒ½æµ‹è¯•..."

# è®°å½•å¼€å§‹æ—¶é—´
START_TIME=$(date +%s%N)

# å‘é€è¯·æ±‚
curl -X POST http://localhost:3000/api/ai/chat-stream \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "message": "æˆ‘æ˜¯æ±Ÿè‹è€ƒç”Ÿï¼Œç‰©ç†ç±»ï¼Œé«˜è€ƒåˆ†æ•°650åˆ†ï¼Œä½æ¬¡1200åï¼Œæˆ‘æƒ³å­¦è®¡ç®—æœºä¸“ä¸š",
    "userId": "test_user_001"
  }' \
  --no-buffer \
  --trace-time \
  > response.log 2>&1

# è®°å½•ç»“æŸæ—¶é—´
END_TIME=$(date +%s%N)

# è®¡ç®—è€—æ—¶
ELAPSED=$((($END_TIME - $START_TIME) / 1000000))

echo "æ€»è€—æ—¶: ${ELAPSED}ms"

# åˆ†ææ—¥å¿—
echo "Tokenæ¶ˆè€—: $(grep -o 'totalTokens":[0-9]*' response.log | cut -d':' -f2)"
echo "æ¨èæ•°é‡: $(grep -o 'totalCount":[0-9]*' response.log | cut -d':' -f2)"
```

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ç¡®ä¿å®ç°æ­£ç¡®ï¼š

### åŠŸèƒ½æµ‹è¯•
- [ ] AIèƒ½æ­£ç¡®è°ƒç”¨ `get_recommendation_ids` å·¥å…·
- [ ] å·¥å…·è¿”å›æ­£ç¡®çš„IDåˆ—è¡¨ï¼ˆå†²12 + ç¨³20 + ä¿8ï¼‰
- [ ] AIèƒ½å‘ç”¨æˆ·è¯´æ˜æ¨èæ¦‚å†µ
- [ ] åç«¯èƒ½æ‰¹é‡è·å–å¡ç‰‡æ•°æ®
- [ ] å¡ç‰‡æ•°æ®èƒ½æ­£ç¡®æ¨é€åˆ°å‰ç«¯
- [ ] å¡ç‰‡åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
- [ ] å¡ç‰‡æ•°æ®æ ¼å¼æ­£ç¡®ï¼ˆJSONå¯è§£æï¼‰

### æ€§èƒ½æµ‹è¯•
- [ ] Tokenæ¶ˆè€—é™ä½åˆ° ~500ï¼ˆvs æ—§ç‰ˆ~20,000ï¼‰
- [ ] é¦–å­—èŠ‚æ—¶é—´ < 1ç§’
- [ ] å¡ç‰‡æ•°æ®è¿”å›æ—¶é—´ 3-5ç§’ï¼ˆvs æ—§ç‰ˆ15-20ç§’ï¼‰
- [ ] æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° 2-3æ¬¡ï¼ˆvs æ—§ç‰ˆ40+æ¬¡ï¼‰

### æ•°æ®è´¨é‡æµ‹è¯•
- [ ] å½•å–æ¦‚ç‡åœ¨ 0-100 èŒƒå›´å†…
- [ ] å†²ç¨³ä¿åˆ†ç±»æ­£ç¡®ï¼ˆå†²<35%ï¼Œç¨³35-90%ï¼Œä¿90-99%ï¼‰
- [ ] å†å²æ•°æ®å®Œæ•´ï¼ˆè‡³å°‘3å¹´ï¼‰
- [ ] ä¸“ä¸šä¿¡æ¯å®Œæ•´ï¼ˆåŒ…å«ä¸“ä¸šåç§°ã€è®¡åˆ’æ•°ç­‰ï¼‰
- [ ] æ¨èç†ç”±åˆç†ï¼ˆè‡³å°‘1æ¡ï¼‰
- [ ] è­¦å‘Šä¿¡æ¯å‡†ç¡®ï¼ˆå¦‚æœ‰é£é™©ï¼‰

### è¾¹ç•Œæµ‹è¯•
- [ ] ç”¨æˆ·æœªæä¾›åˆ†æ•°/ä½æ¬¡æ—¶çš„é”™è¯¯æç¤º
- [ ] æ•°æ®åº“æ— åŒ¹é…æ•°æ®æ—¶çš„å¤„ç†
- [ ] éƒ¨åˆ†IDæŸ¥è¯¢å¤±è´¥æ—¶çš„é™çº§å¤„ç†
- [ ] ç½‘ç»œè¶…æ—¶æ—¶çš„é”™è¯¯å¤„ç†

### å‘åå…¼å®¹æµ‹è¯•
- [ ] æ—§çš„ `smart_recommendation` å·¥å…·ä»å¯ç”¨
- [ ] AIèƒ½æ ¹æ®æƒ…å†µé€‰æ‹©åˆé€‚çš„å·¥å…·
- [ ] ä¸¤ç§å·¥å…·çš„ç»“æœä¸€è‡´æ€§

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚åœ¨æµ‹è¯•ä¸­å‘ç°é—®é¢˜ï¼Œè¯·è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **è¯·æ±‚å†…å®¹**ï¼šå®Œæ•´çš„APIè¯·æ±‚
2. **é¢„æœŸç»“æœ**ï¼šæœŸæœ›å¾—åˆ°ä»€ä¹ˆ
3. **å®é™…ç»“æœ**ï¼šå®é™…å¾—åˆ°ä»€ä¹ˆ
4. **æœåŠ¡å™¨æ—¥å¿—**ï¼šç›¸å…³çš„æ—¥å¿—è¾“å‡º
5. **é”™è¯¯ä¿¡æ¯**ï¼šå®Œæ•´çš„é”™è¯¯å †æ ˆ

---

**æµ‹è¯•æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025-01-31
**é€‚ç”¨ç‰ˆæœ¬**: V2æ¨èå¡ç‰‡å®ç°
