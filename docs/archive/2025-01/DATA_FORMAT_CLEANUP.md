# 数据格式自动清理功能说明

## ✅ 已修复问题

导入脚本现在支持自动清理和标准化以下数据格式：

---

## 🔧 支持的数据格式

### 1. 列名映射

现在支持更多列名变体：

| 标准列名 | 支持的变体 |
|---------|-----------|
| 科类 | `科类`、`科目类型`、`科目`、`subjectType` |
| 年份 | `年份`、`year` |
| 省份 | `省份`、`province` |
| 分数 | `分数`、`score` |
| 人数 | `人数`、`count` |

### 2. 年份格式清理

✅ **自动去除"年"字**

| 原始数据 | 清理后 |
|---------|--------|
| `2025年` | `2025` |
| `2024年` | `2024` |
| `2025` | `2025` |

### 3. 省份格式清理

✅ **自动去除"省"字**

| 原始数据 | 清理后 |
|---------|--------|
| `江苏省` | `江苏` |
| `河南省` | `河南` |
| `北京` | `北京` |

### 4. 科目/科类标准化

✅ **自动标准化科目名称**

| 原始数据 | 标准化后 |
|---------|---------|
| `物理` | `物理类` |
| `历史` | `历史类` |
| `物理类` | `物理类` |
| `理科` | `理科` |
| `文科` | `文科` |
| `综合` | `综合` |

### 5. 分数格式清理

✅ **自动提取数字**

| 原始数据 | 清理后 |
|---------|--------|
| `683及以上` | `683` |
| `600以下` | `600` |
| `650` | `650` |
| `680分` | `680` |

---

## 📊 您的数据示例

原始数据：
```
年份: 2025年
省份: 江苏省
科目: 物理
分数: 683及以上
人数: 126
累计人数: 126
位次: 126
```

清理后：
```
年份: 2025
省份: 江苏
科类: 物理类
分数: 683
人数: 126
累计人数: 126
位次: 126
```

---

## 🚀 现在可以直接导入了！

```powershell
# 重新运行导入脚本
node scripts/import-excel-directly.js E:\5plus1\DEV\zytb\zy_backend\data\hz.xlsx

# 或使用批处理脚本（会自动编译）
scripts\import-excel.bat E:\5plus1\DEV\zytb\zy_backend\data\hz.xlsx
```

---

## ✨ 支持的 Excel 格式示例

### 格式 A（标准格式）
| 年份 | 省份 | 科类 | 分数 | 人数 | 累计人数 | 位次 |
|------|------|------|------|------|----------|------|
| 2024 | 河南 | 物理类 | 700 | 15 | 15 | 1 |

### 格式 B（带单位格式） ✅ 现在支持！
| 年份 | 省份 | 科目 | 分数 | 人数 | 累计人数 | 位次 |
|------|------|------|------|------|----------|------|
| 2025年 | 江苏省 | 物理 | 683及以上 | 126 | 126 | 126 |

### 格式 C（混合格式） ✅ 现在支持！
| 年份 | 省份 | 科目类型 | 分数 | 人数 | 累计人数 | 位次 |
|------|------|---------|------|------|----------|------|
| 2024年 | 河南省 | 历史 | 650分 | 28 | 28 | 1 |

---

## 📝 注意事项

1. **年份范围**：清理后的年份必须在 2000-2100 之间
2. **分数范围**：清理后的分数必须在 0-999 之间
3. **人数验证**：人数必须 ≥ 0
4. **必填字段**：年份、省份、科类/科目、分数、人数

---

## 🎯 快速测试

```powershell
# 1. 先编译（如果使用 bat 脚本会自动编译）
npm run build

# 2. 导入您的数据
node scripts/import-excel-directly.js E:\5plus1\DEV\zytb\zy_backend\data\hz.xlsx

# 3. 如果需要覆盖已有数据
node scripts/import-excel-directly.js E:\5plus1\DEV\zytb\zy_backend\data\hz.xlsx --clear
```

现在您的数据应该可以成功导入了！
