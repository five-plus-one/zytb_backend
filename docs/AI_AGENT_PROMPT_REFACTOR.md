# AI Agent 系统提示词重构说明

## 更新时间
2025-10-29

## 重构目标
根据《关于志愿.md》中的专业志愿填报知识体系，重构 AI Agent 的系统提示词和工具描述，使其更加专业、准确，符合实际志愿填报流程。

## 核心理念变更

### 从"最好"到"不后悔"
**旧理念**：帮助考生找到"最好、最完美"的志愿
**新理念**：帮助考生做出"不后悔"的志愿选择

成年人真实的选择中，没有完美，只有权衡和舍得。关键是：
- 在考生最看重的地方取
- 在考生最不看重的地方舍
- 避免稀里糊涂做决定

## 重构内容

### 1. 系统提示词全面重构

文件：[src/ai/agent.service.ts](../src/ai/agent.service.ts:62-204)

#### 新增核心知识模块

**录取机制理解**
- 平行志愿三原则：分数优先、遵循志愿、一次投档
- 位次的重要性：比分数更稳定可靠
- 退档风险：退档即掉批次
- 新高考特点：削弱学校对专业的支配权

**数据分析方法（按分数段）**
- 高分段（前15%）：优先使用位次法
  - 冲稳保比例：位次±3%~30%
- 中分段（15%-80%）：优先使用同位分法
  - 冲稳保比例：同位分±3~20分
- 低分段（后20%）：优先使用线差法
  - 冲稳保比例：线差±3~20分

**冲稳保策略核心原则**
- 冲一冲：给自己机会但不盲目
  - 红线：冲上去专业不可选，且不是喜欢的冷门专业→删除
- 稳一稳：最需要认真的区间（最容易录取也最容易退档）
  - 调研时间必须是冲和保的3倍
  - 每个志愿都要问：是期待被录取还是害怕被录取？
- 保一保：确保不滑档
  - 分层次保，批次保底

**新高考特殊策略（江苏）**
- 降5分原则：专业间差距3-7分，建议整体降5分考虑
- 专业组内拉开梯度：不要认为在一个组内就可以随便填
- 主动保底策略：永远选择主动保底而不是被动调剂
- 保院校 vs 保专业：
  - 保院校：分数最大化利用
  - 保专业：降5-10分处理数据

**决策维度权衡**
- 院校维度：头衔、学术实力（硕博点）、升学率
- 专业维度：发展脉络、硕博点规模、就业趋势
- 城市维度：二线及以上、两线两点、地域性招聘

### 2. 工具描述优化

所有工具描述都进行了重构，使其更符合志愿填报的专业场景：

#### 等位分查询工具
**文件**：[src/ai/tools/equivalentScore.tool.ts](../src/ai/tools/equivalentScore.tool.ts:9)

**旧描述**：
> 查询等位分：根据当前年份的分数，查询往年同位次对应的分数。用于分析历年分数趋势。

**新描述**：
> 查询等位分（同位分）：这是中分段（批次15%-80%）最重要的定位工具。根据今年的分数和位次，查询往年相同位次对应的分数，用于框定院校初始范围。位次比分数更稳定可靠。适用场景：考生问"我今年XXX分，往年大概什么分？"或需要进行冲稳保院校定位时。

#### 分数转位次工具
**文件**：[src/ai/tools/scoreRanking.tool.ts](../src/ai/tools/scoreRanking.tool.ts:9)

**新描述**：
> 分数转位次：查询某个分数对应的位次排名。位次是最可靠的定位指标，尤其适用于高分段（批次前15%）考生。用于了解"我这个分数能排第几名？"，是使用位次法和同位分法的基础数据。

#### 位次转分数工具
**文件**：[src/ai/tools/scoreRanking.tool.ts](../src/ai/tools/scoreRanking.tool.ts:72)

**新描述**：
> 位次转分数：根据位次排名查询对应的分数。用于位次法定位时，将位次百分比（如+10%、-20%）换算成具体分数区间，或帮助考生理解"位次5000名是多少分？"

#### 专业筛选工具
**文件**：[src/ai/tools/majorFilter.tool.ts](../src/ai/tools/majorFilter.tool.ts:9)

**新描述**：
> 筛选专业招生计划：在圈定院校范围后，根据分数、专业方向、院校等条件筛选具体的招生计划。展示往年录取分数用于冲稳保判断。适用于"XXX分能上哪些计算机专业？"或"帮我看看这个分数段有什么好专业"。注意：江苏考生建议分数降5分使用，以确保专业选择权。

#### 招生计划详情工具
**文件**：[src/ai/tools/enrollmentPlan.tool.ts](../src/ai/tools/enrollmentPlan.tool.ts:9)

**新描述**：
> 查询招生计划详情：深度调研某个院校的招生计划，包含专业组划分、招生人数、选科要求、往年3年录取分数等。用于"稳一稳"区间的认真调研，了解院校的详细招生情况。适合考生明确想了解某个学校时使用。

#### 按院校查询专业组工具
**文件**：[src/ai/tools/enrollmentPlan.tool.ts](../src/ai/tools/enrollmentPlan.tool.ts:87)

**新描述**：
> 按院校查询专业组结构：查询某个院校有哪些专业组，每个专业组包含哪些专业。帮助考生理解江苏"院校+专业组"的志愿结构，判断专业组内是否需要拉开梯度。适用于考生问"XX大学有哪些专业组？"或需要了解专业组内部专业分布。

#### 院校历史统计工具
**文件**：[src/ai/tools/enrollmentPlan.tool.ts](../src/ai/tools/enrollmentPlan.tool.ts:151)

**新描述**：
> 查询院校历史录取统计：查询某个院校近几年的录取分数趋势（最高分、最低分、平均分、录取位次）。用于判断院校录取分数的稳定性，辅助冲稳保判断。适用于考生问"XX大学往年分数线？"或需要验证院校是否符合冲/稳/保定位。

## 关键变化总结

### 1. 更加强调"不后悔"的决策理念
不再追求"完美"和"不浪费分数"，而是帮助考生做出清晰、理性的选择。

### 2. 按分数段提供差异化策略
- 高分段用位次法
- 中分段用同位分法
- 低分段用线差法

### 3. 突出江苏新高考特点
- 降5分原则
- 专业组内拉开梯度
- 主动保底而非被动调剂

### 4. 强调冲稳保的专业逻辑
- 冲：有机会但不盲目（红线问题）
- 稳：最认真调研（3倍时间）
- 保：分层次保底

### 5. 工具描述场景化
每个工具都明确说明：
- 适用场景
- 用户问法示例
- 在志愿填报流程中的作用

## 效果验证

### 服务器启动日志
```
✅ 数据库连接成功
✅ 工具注册成功: query_equivalent_score
✅ 工具注册成功: filter_majors
✅ 工具注册成功: get_major_directions
✅ 工具注册成功: query_enrollment_plan
✅ 工具注册成功: query_enrollment_by_college
✅ 工具注册成功: query_college_stats
✅ 工具注册成功: score_to_rank
✅ 工具注册成功: rank_to_score
✅ 工具注册成功: get_score_distribution

🔧 AI工具系统初始化完成
📊 已注册 9 个工具
```

### AI Agent 现在能够：
1. ✅ 理解志愿填报的专业流程和逻辑
2. ✅ 根据考生分数段选择合适的定位方法
3. ✅ 提供符合江苏新高考特点的建议
4. ✅ 解释冲稳保策略的专业逻辑
5. ✅ 强调"不后悔"而非"完美"的决策理念
6. ✅ 提醒考生自己做决定的重要性
7. ✅ 识别并警示红线问题（如冲学校但专业完全不可选）

## 下一步建议

### 短期（立即可做）
1. 测试 AI Agent 对不同场景的响应
2. 收集实际使用反馈，优化提示词
3. 补充更多志愿填报的边界案例处理

### 中期（1-2周）
1. 添加更多专业工具（院校对比、专业推荐等）
2. 优化工具调用逻辑，减少不必要的 API 调用
3. 实现会话持久化（Redis）

### 长期（1个月以上）
1. 支持更多省份的志愿填报策略
2. 集成更多数据源（专业评价、就业数据等）
3. 构建志愿填报知识图谱
4. 实现智能推荐算法

## 参考资料

- [关于志愿.md](../docs/Reference/关于志愿.md) - 志愿填报核心知识
- [AI_AGENT_API.md](./AI_AGENT_API.md) - 前端集成文档
- [AI_AGENT_SETUP.md](./AI_AGENT_SETUP.md) - 系统配置文档

---

**更新人**: Claude Code AI Assistant
**审核**: 待人工审核
**状态**: ✅ 已完成重构并上线运行
