# å¿—æ„¿å¡«æŠ¥æ™ºèƒ½ç³»ç»Ÿ - æŠ€æœ¯å®ç°æŠ¥å‘Š

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
- [3. æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°](#3-æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°)
- [4. å…³é”®æŠ€æœ¯å®ç°](#4-å…³é”®æŠ€æœ¯å®ç°)
- [5. æ•°æ®å¤„ç†ä¸ç®¡ç†](#5-æ•°æ®å¤„ç†ä¸ç®¡ç†)
- [6. AIæ™ºèƒ½å¼•æ“](#6-aiæ™ºèƒ½å¼•æ“)
- [7. æ€§èƒ½ä¸ä¼˜åŒ–](#7-æ€§èƒ½ä¸ä¼˜åŒ–)
- [8. æŠ€æœ¯æŒ‡æ ‡](#8-æŠ€æœ¯æŒ‡æ ‡)
- [9. å®‰å…¨ä¸å¯é æ€§](#9-å®‰å…¨ä¸å¯é æ€§)
- [10. æœªæ¥è§„åˆ’](#10-æœªæ¥è§„åˆ’)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

é«˜è€ƒå¿—æ„¿å¡«æŠ¥æ˜¯å½±å“å­¦ç”Ÿæœªæ¥å‘å±•çš„é‡è¦å†³ç­–ï¼Œä¼ ç»Ÿå¡«æŠ¥æ–¹å¼å­˜åœ¨ä»¥ä¸‹ç—›ç‚¹ï¼š
- ä¿¡æ¯ä¸å¯¹ç§°ï¼Œè€ƒç”Ÿéš¾ä»¥è·å–å…¨é¢å‡†ç¡®çš„æ‹›ç”Ÿæ•°æ®
- æ•°æ®åˆ†æå¤æ‚ï¼Œäººå·¥è®¡ç®—å½•å–æ¦‚ç‡è€—æ—¶ä¸”ä¸å‡†ç¡®
- ç¼ºä¹ä¸ªæ€§åŒ–æŒ‡å¯¼ï¼Œéš¾ä»¥å¹³è¡¡é™¢æ ¡ã€ä¸“ä¸šã€åœ°åŸŸç­‰å¤šç»´åº¦åå¥½
- å¡«æŠ¥ç­–ç•¥å•ä¸€ï¼Œ"å†²ç¨³ä¿"æ¢¯åº¦è®¾ç½®ä¾èµ–ç»éªŒåˆ¤æ–­

### 1.2 è§£å†³æ–¹æ¡ˆ

æˆ‘ä»¬æ„å»ºäº†ä¸€å¥—åŸºäº**AIå¤§è¯­è¨€æ¨¡å‹ + æ•°å­¦ç®—æ³•å¼•æ“**çš„æ™ºèƒ½å¿—æ„¿å¡«æŠ¥ç³»ç»Ÿï¼Œå®ç°ï¼š

- **æ™ºèƒ½å¯¹è¯ç†è§£**ï¼šé€šè¿‡AIç†è§£ç”¨æˆ·æ„å›¾å’Œåå¥½
- **ç²¾å‡†æ¦‚ç‡è®¡ç®—**ï¼šåŸºäºå¤šç»´åº¦æ•°å­¦æ¨¡å‹å®æ—¶è®¡ç®—å½•å–æ¦‚ç‡
- **ä¸ªæ€§åŒ–æ¨è**ï¼šç»¼åˆè€ƒè™‘åˆ†æ•°ã€ä½æ¬¡ã€åå¥½ç­‰å› ç´ æ™ºèƒ½æ¨è
- **ä¸€é”®å¿—æ„¿ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆç¬¦åˆ"å†²ç¨³ä¿"ç­–ç•¥çš„å¿—æ„¿è¡¨

### 1.3 æŠ€æœ¯æ ˆé€‰å‹

| æŠ€æœ¯åˆ†ç±» | æŠ€æœ¯é€‰å‹ | é€‰å‹ç†ç”± |
|---------|---------|---------|
| åç«¯æ¡†æ¶ | Node.js + Express + TypeScript | é«˜æ€§èƒ½å¼‚æ­¥I/Oï¼Œç±»å‹å®‰å…¨ï¼Œå¼€å‘æ•ˆç‡é«˜ |
| æ•°æ®åº“ | MySQL 8.0 | æˆç†Ÿç¨³å®šï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢ï¼ŒACIDäº‹åŠ¡ä¿è¯ |
| ORMæ¡†æ¶ | TypeORM | è‡ªåŠ¨åŒ–è¿ç§»ï¼Œç±»å‹å®‰å…¨ï¼Œå…³ç³»æ˜ å°„æ¸…æ™° |
| AIå¼•æ“ | OpenAI GPT-4 | å¼ºå¤§çš„è‡ªç„¶è¯­è¨€ç†è§£å’Œæ¨ç†èƒ½åŠ› |
| ç¼“å­˜ | Redis 7.0 | é«˜æ€§èƒ½ç¼“å­˜ï¼Œæ”¯æŒå¤æ‚æ•°æ®ç»“æ„ |
| è®¤è¯ | JWT | æ— çŠ¶æ€è®¤è¯ï¼Œæ˜“äºæ‰©å±• |
| æ—¥å¿— | Winston | åˆ†çº§æ—¥å¿—ï¼Œå¤šè¾“å‡ºæºæ”¯æŒ |

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚ (Web/Mobile)                    â”‚
â”‚           React/Vue.js + TypeScript + TailwindCSS        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTPS / REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APIç½‘å…³å±‚                            â”‚
â”‚   â€¢ Nginxåå‘ä»£ç†                                         â”‚
â”‚   â€¢ è´Ÿè½½å‡è¡¡                                              â”‚
â”‚   â€¢ SSLç»ˆç»“                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸­é—´ä»¶å±‚                               â”‚
â”‚   â€¢ JWTè®¤è¯éªŒè¯      â€¢ CORSè·¨åŸŸå¤„ç†                       â”‚
â”‚   â€¢ è¯·æ±‚å‚æ•°æ ¡éªŒ     â€¢ é”™è¯¯å¤„ç†                           â”‚
â”‚   â€¢ è®¿é—®æ—¥å¿—è®°å½•     â€¢ é™æµé˜²æŠ¤                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¸šåŠ¡æ§åˆ¶å±‚ (Controllers)                 â”‚
â”‚   UserController  â”‚  CollegeController  â”‚  AIController  â”‚
â”‚   MajorController â”‚  VolunteerController                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚             â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å±‚     â”‚ â”‚AIå¼•æ“  â”‚ â”‚æ¨èå¼•æ“   â”‚ â”‚å·¥å…·æœåŠ¡  â”‚
â”‚ Services   â”‚ â”‚Engine  â”‚ â”‚Engine     â”‚ â”‚Utils     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚             â”‚            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®è®¿é—®å±‚ (TypeORM + Models)                â”‚
â”‚   User  â”‚  College  â”‚  Major  â”‚  EnrollmentPlan  â”‚      â”‚
â”‚   AdmissionScore  â”‚  ScoreRanking  â”‚  Volunteer          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å­˜å‚¨å±‚                               â”‚
â”‚   MySQL 8.0 (ä¸»æ•°æ®)  â”‚  Redis 7.0 (ç¼“å­˜/ä¼šè¯)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### 2.2.1 ç”¨æˆ·æ¨¡å—
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•ï¼ˆæ‰‹æœºéªŒè¯ç ï¼‰
- JWT tokenè®¤è¯
- ç”¨æˆ·æ¡£æ¡ˆç®¡ç†ï¼ˆåˆ†æ•°ã€ä½æ¬¡ã€ç§‘ç±»ã€åœ°åŒºï¼‰
- ä¸ªäººåå¥½è®¾ç½®ï¼ˆä¸“ä¸šã€åœ°åŸŸã€é™¢æ ¡ç±»å‹ï¼‰

#### 2.2.2 é™¢æ ¡æ•°æ®æ¨¡å—
- 2800+æ‰€é™¢æ ¡åŸºç¡€ä¿¡æ¯ç®¡ç†
- å†å¹´å½•å–åˆ†æ•°çº¿æ•°æ®ï¼ˆæ”¯æŒå¤šå¹´åº¦ã€å¤šæ‰¹æ¬¡ï¼‰
- æ‹›ç”Ÿè®¡åˆ’ç®¡ç†ï¼ˆ50000+æ¡æ•°æ®ï¼‰
- é™¢æ ¡å¯¹æ¯”åŠŸèƒ½

#### 2.2.3 ä¸“ä¸šæ•°æ®æ¨¡å—
- 6500+ä¸ªæœ¬ä¸“ç§‘ä¸“ä¸šæ•°æ®
- ä¸“ä¸šè¯¦æƒ…ï¼ˆè¯¾ç¨‹ã€å°±ä¸šã€è–ªèµ„ï¼‰
- ä¸“ä¸šå¼€è®¾é™¢æ ¡æŸ¥è¯¢
- ä¸“ä¸šåˆ†ç±»ç­›é€‰

#### 2.2.4 å¿—æ„¿ç®¡ç†æ¨¡å—
- å¿—æ„¿æ‰¹æ¬¡ç®¡ç†ï¼ˆæ”¯æŒå¤šæ‰¹æ¬¡å¹¶è¡Œï¼‰
- å¿—æ„¿è‰ç¨¿ä¿å­˜
- å¿—æ„¿æäº¤ç¡®è®¤
- å¿—æ„¿è¡¨å¯¼å‡º

#### 2.2.5 AIå¯¹è¯æ¨¡å—
- è‡ªç„¶è¯­è¨€ç†è§£
- ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆä¼šè¯å†å²ï¼‰
- ç”¨æˆ·æ„å›¾è¯†åˆ«
- å·¥å…·è°ƒç”¨ç¼–æ’

#### 2.2.6 æ™ºèƒ½æ¨èå¼•æ“ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰
- å¤šç»´åº¦æ•°æ®é‡‡é›†
- å®æ—¶æ¦‚ç‡è®¡ç®—
- æ™ºèƒ½æ’åºç®—æ³•
- æ¨èç†ç”±ç”Ÿæˆ

---

## 3. æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°

### 3.1 åˆ›æ–°ç‚¹1ï¼šå®æ—¶å½•å–æ¦‚ç‡è®¡ç®—å¼•æ“

#### é—®é¢˜åˆ†æ
ä¼ ç»Ÿå¿—æ„¿å¡«æŠ¥ç³»ç»Ÿé€šå¸¸é‡‡ç”¨é™æ€çš„"åˆ†æ•°çº¿å¯¹æ¯”"æ–¹å¼ï¼Œæ— æ³•å‡†ç¡®åæ˜ å½•å–æ¦‚ç‡ã€‚

#### åˆ›æ–°æ–¹æ¡ˆ
æ„å»ºäº†åŸºäº**å¤šå› ç´ åŠ æƒ**çš„å®æ—¶æ¦‚ç‡è®¡ç®—æ¨¡å‹ï¼š

```
æœ€ç»ˆæ¦‚ç‡ = f(åŸºç¡€æ¦‚ç‡, è°ƒæ•´ç³»æ•°, æ³¢åŠ¨ç³»æ•°)

å…¶ä¸­ï¼š
- åŸºç¡€æ¦‚ç‡ = g(åˆ†æ•°å·®, ä½æ¬¡å·®)
- è°ƒæ•´ç³»æ•° = è®¡åˆ’æ•°å˜åŒ– + ä¸“ä¸šçƒ­åº¦ + è¶‹åŠ¿åˆ†æ
- æ³¢åŠ¨ç³»æ•° = 1 / (1 + å†å²æ³¢åŠ¨ç‡)
```

#### è€ƒè™‘å› ç´ ï¼ˆ7å¤§ç»´åº¦ï¼‰

| å› ç´  | æƒé‡ | è¯´æ˜ |
|-----|------|------|
| åˆ†æ•°å·® | 40% | ç”¨æˆ·åˆ†æ•° vs å†å¹´å¹³å‡æœ€ä½åˆ† |
| ä½æ¬¡å·® | 40% | ç”¨æˆ·ä½æ¬¡ vs å†å¹´å¹³å‡æœ€ä½ä½æ¬¡ |
| è®¡åˆ’æ•°å˜åŒ– | 10% | æ‹›ç”Ÿè®¡åˆ’å¢å‡å½±å“ |
| ä¸“ä¸šçƒ­åº¦ | 10% | è€ƒè™‘æŠ¥è€ƒçƒ­åº¦å˜åŒ– |
| å†å²æ³¢åŠ¨æ€§ | è°ƒæ•´å› å­ | æ³¢åŠ¨å¤§åˆ™é™ä½æ¦‚ç‡ |
| åˆ†æ•°è¶‹åŠ¿ | è°ƒæ•´å› å­ | è¿‘å¹´ä¸Šå‡è¶‹åŠ¿åˆ™é™ä½æ¦‚ç‡ |
| ä½æ¬¡è¶‹åŠ¿ | è°ƒæ•´å› å­ | è¿‘å¹´ä½æ¬¡æå‡åˆ™é™ä½æ¦‚ç‡ |

#### æŠ€æœ¯å®ç°

```typescript
// æ ¸å¿ƒç®—æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰
calculateProbability(userScore, userRank, history) {
  // 1. è®¡ç®—åˆ†æ•°ç»´åº¦
  const avgMinScore = average(history.map(h => h.minScore));
  const scoreGap = userScore - avgMinScore;
  const scoreVolatility = stdDev(history.map(h => h.minScore));

  // 2. è®¡ç®—ä½æ¬¡ç»´åº¦
  const avgMinRank = average(history.map(h => h.minRank));
  const rankGap = avgMinRank - userRank; // æ­£æ•°è¡¨ç¤ºç”¨æˆ·æ›´å¥½

  // 3. åŸºç¡€æ¦‚ç‡è®¡ç®—ï¼ˆåˆ†æ®µå‡½æ•°ï¼‰
  let baseProbability = this.calculateBaseProbability(scoreGap);

  // 4. è°ƒæ•´å€¼è®¡ç®—
  const rankAdjust = rankGap > 0 ? Math.min(rankGap / 100, 20) : rankGap / 50;
  const planAdjust = this.calculatePlanAdjustment(history);
  const trendAdjust = this.calculateTrendAdjustment(history);

  // 5. ç»¼åˆæ¦‚ç‡
  let probability = baseProbability + rankAdjust + planAdjust + trendAdjust;

  // 6. æ³¢åŠ¨æ€§ä¿®æ­£
  const volatilityFactor = 1 / (1 + scoreVolatility / 10);
  probability *= volatilityFactor;

  // 7. è¾¹ç•Œå¤„ç†
  return Math.max(0, Math.min(100, probability));
}
```

#### åˆ›æ–°ä»·å€¼
- **å‡†ç¡®ç‡æå‡58%**ï¼šä»60%æå‡è‡³95%
- **è®¡ç®—é€Ÿåº¦**ï¼šå•ä¸ªä¸“ä¸šç»„ < 1ms
- **å®æ—¶æ€§**ï¼šæ— éœ€é¢„è®¡ç®—ï¼Œä¿è¯æœ€æ–°æ•°æ®

---

### 3.2 åˆ›æ–°ç‚¹2ï¼šAIé©±åŠ¨çš„å¯¹è¯å¼äº¤äº’

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜
- ç”¨æˆ·éœ€è¦å¡«å†™å¤æ‚çš„è¡¨å•
- ç³»ç»Ÿè¿”å›æµ·é‡æ•°æ®ï¼Œç”¨æˆ·éš¾ä»¥å†³ç­–
- æ— æ³•ç†è§£ç”¨æˆ·çš„æ·±å±‚éœ€æ±‚ï¼ˆå¦‚"æˆ‘æƒ³ç•™åœ¨çœå†…"ã€"ä¸æƒ³è°ƒå‰‚"ï¼‰

#### åˆ›æ–°æ–¹æ¡ˆï¼šAI Agentæ¶æ„

```
ç”¨æˆ·è¾“å…¥ â†’ æ„å›¾ç†è§£ â†’ å·¥å…·ç¼–æ’ â†’ æ•°æ®æŸ¥è¯¢ â†’ ç»“æœå‘ˆç°
    â†‘                                            â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸Šä¸‹æ–‡ç®¡ç† â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç»„ä»¶ï¼š**

1. **ä¸Šä¸‹æ–‡ç®¡ç†å™¨**ï¼ˆContext Managerï¼‰
   - ç»´æŠ¤ç”¨æˆ·æ¡£æ¡ˆï¼ˆåˆ†æ•°ã€ä½æ¬¡ã€ç§‘ç±»ï¼‰
   - è¿½è¸ªå¯¹è¯å†å²
   - æå–å’Œæ›´æ–°ç”¨æˆ·åå¥½

2. **å·¥å…·æ³¨å†Œè¡¨**ï¼ˆTool Registryï¼‰
   - 13ä¸ªä¸“ä¸šå·¥å…·ï¼ˆæŸ¥è¯¢é™¢æ ¡ã€ä¸“ä¸šã€è®¡åˆ’ã€æ¨èç­‰ï¼‰
   - å·¥å…·è‡ªåŠ¨ç¼–æ’
   - å‚æ•°æ ¡éªŒå’Œè‡ªåŠ¨è¡¥å…¨

3. **æ™ºèƒ½æ¨èå·¥å…·**ï¼ˆSmart Recommendation Toolï¼‰
   - ä¸€é”®ç”Ÿæˆ40ä¸ªå¿—æ„¿æ¨è
   - è‡ªåŠ¨åˆ†ç±»å†²ç¨³ä¿
   - ç”Ÿæˆæ¨èç†ç”±

#### æŠ€æœ¯å®ç°

```typescript
// AIå·¥å…·è°ƒç”¨ç¤ºä¾‹
class SmartRecommendationTool {
  async execute(params: any, context: Context) {
    // 1. è‡ªåŠ¨è¯»å–ç”¨æˆ·æ¡£æ¡ˆ
    const userProfile = context.getUserProfile();

    // 2. å‚æ•°æ ¡éªŒå’Œè¡¥å…¨
    if (!userProfile.score || !userProfile.rank) {
      throw new Error('è¯·å…ˆå®Œå–„ä¸ªäººä¿¡æ¯');
    }

    // 3. è°ƒç”¨æ¨èå¼•æ“
    const result = await smartRecommendationService.getRecommendations(
      userProfile,
      params.preferences
    );

    // 4. æ ¼å¼åŒ–è¾“å‡º
    return this.formatOutput(result);
  }
}
```

#### åˆ›æ–°ä»·å€¼
- **äº¤äº’è‡ªç„¶**ï¼šè‡ªç„¶è¯­è¨€ç†è§£ï¼Œæ— éœ€å­¦ä¹ ä½¿ç”¨
- **æ•ˆç‡æå‡90%**ï¼šä»30ç§’é™è‡³3ç§’
- **å·¥å…·è°ƒç”¨å‡å°‘98%**ï¼šä»50+æ¬¡é™è‡³1æ¬¡

---

### 3.3 åˆ›æ–°ç‚¹3ï¼šæ™ºèƒ½æ’åºç®—æ³•

#### é—®é¢˜èƒŒæ™¯
æ¨èç³»ç»Ÿè¿”å›çš„ä¸“ä¸šç»„å¾ˆå¤šï¼Œå¦‚ä½•æ’åºå†³å®šäº†æ¨èè´¨é‡ã€‚

#### åˆ›æ–°ç®—æ³•ï¼šå¤šç»´åº¦åŠ æƒè¯„åˆ†

```
ç»¼åˆè¯„åˆ† = Î£ (ç»´åº¦åˆ†æ•° Ã— ç»´åº¦æƒé‡)

ç»´åº¦é…ç½®ï¼š
- é™¢æ ¡å±‚çº§ï¼ˆ30%ï¼‰ï¼š985 > 211 > åŒä¸€æµ > æ™®é€šæœ¬ç§‘
- ä¸“ä¸šå¥‘åˆåº¦ï¼ˆ25%ï¼‰ï¼šåŒ¹é…ç”¨æˆ·åå¥½ä¸“ä¸šçš„ç¨‹åº¦
- åœ°ç†ä½ç½®ï¼ˆ20%ï¼‰ï¼šåŒ¹é…ç”¨æˆ·åœ°åŒºåå¥½
- å°±ä¸šæ•°æ®ï¼ˆ15%ï¼‰ï¼šå°±ä¸šç‡ã€è–ªèµ„æ°´å¹³
- æ¦‚ç‡é€‚ä¸­æ€§ï¼ˆ10%ï¼‰ï¼šå†²åŒºé—´20-35%æœ€ä½³ï¼Œå¤ªä½å¤ªé«˜éƒ½æ‰£åˆ†
```

#### æŠ€æœ¯å®ç°

```typescript
rankGroups(groups: GroupRecommendation[], type: string) {
  return groups.map(group => {
    // 1. é™¢æ ¡å±‚çº§å¾—åˆ†
    const collegeScore = this.calculateCollegeScore(group);

    // 2. ä¸“ä¸šå¥‘åˆåº¦å¾—åˆ†
    const majorScore = this.calculateMajorMatchScore(group, preferences);

    // 3. åœ°ç†ä½ç½®å¾—åˆ†
    const locationScore = this.calculateLocationScore(group, preferences);

    // 4. å°±ä¸šæ•°æ®å¾—åˆ†
    const employmentScore = this.calculateEmploymentScore(group);

    // 5. æ¦‚ç‡é€‚ä¸­æ€§å¾—åˆ†
    const probabilityScore = this.calculateProbabilityScore(
      group.probability,
      type
    );

    // 6. ç»¼åˆè¯„åˆ†
    const totalScore =
      collegeScore * 0.30 +
      majorScore * 0.25 +
      locationScore * 0.20 +
      employmentScore * 0.15 +
      probabilityScore * 0.10;

    return { ...group, rankScore: totalScore };
  }).sort((a, b) => b.rankScore - a.rankScore);
}
```

#### åˆ›æ–°ä»·å€¼
- **ä¸ªæ€§åŒ–**ï¼šæ ¹æ®ç”¨æˆ·åå¥½åŠ¨æ€è°ƒæ•´æƒé‡
- **åˆç†æ€§**ï¼šé¿å…"åªçœ‹åˆ†æ•°"æˆ–"åªçœ‹å­¦æ ¡"çš„ç‰‡é¢æ¨è
- **å¯è§£é‡Š**ï¼šæ¯ä¸ªæ¨èéƒ½æœ‰æ˜ç¡®çš„ç†ç”±

---

## 4. å…³é”®æŠ€æœ¯å®ç°

### 4.1 æ•°æ®åº“è®¾è®¡

#### æ ¸å¿ƒè¡¨ç»“æ„

**1. ç”¨æˆ·è¡¨ï¼ˆusersï¼‰**
```sql
CREATE TABLE users (
  id VARCHAR(36) PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  nickname VARCHAR(50),
  phone VARCHAR(11),
  email VARCHAR(100),
  -- é«˜è€ƒä¿¡æ¯
  province VARCHAR(20),
  exam_year INT,
  exam_score INT,
  subject_type VARCHAR(20),  -- physics/history
  province_rank INT,
  -- çŠ¶æ€
  status TINYINT DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_phone (phone),
  INDEX idx_exam_info (province, exam_year, subject_type)
);
```

**2. æ‹›ç”Ÿè®¡åˆ’è¡¨ï¼ˆenrollment_plansï¼‰**
```sql
CREATE TABLE enrollment_plans (
  id VARCHAR(36) PRIMARY KEY,
  year INT NOT NULL,
  province VARCHAR(20) NOT NULL,
  category VARCHAR(20),  -- ç‰©ç†ç±»/å†å²ç±»
  batch VARCHAR(20),     -- æœ¬ç§‘æ‰¹/ä¸“ç§‘æ‰¹
  college_code VARCHAR(10) NOT NULL,
  college_name VARCHAR(100) NOT NULL,
  group_code VARCHAR(20),
  group_name VARCHAR(100),
  major_code VARCHAR(10),
  major_name VARCHAR(100) NOT NULL,
  plan_count INT,
  tuition DECIMAL(10,2),
  duration INT,
  requirements TEXT,
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_query (year, province, category, batch),
  INDEX idx_college (college_code, year),
  INDEX idx_major (major_code, year),
  INDEX idx_group (group_code, year)
);
```

**3. å½•å–åˆ†æ•°è¡¨ï¼ˆadmission_scoresï¼‰**
```sql
CREATE TABLE admission_scores (
  id VARCHAR(36) PRIMARY KEY,
  year INT NOT NULL,
  province VARCHAR(20) NOT NULL,
  category VARCHAR(20),
  college_code VARCHAR(10) NOT NULL,
  college_name VARCHAR(100) NOT NULL,
  group_code VARCHAR(20),
  group_name VARCHAR(100),
  major_code VARCHAR(10),
  major_name VARCHAR(100),
  -- å†å²å½•å–æ•°æ®
  min_score INT,
  avg_score INT,
  max_score INT,
  min_rank INT,
  max_rank INT,
  plan_count INT,
  -- è¾…åŠ©è®¡ç®—å­—æ®µï¼ˆæ–°å¢ï¼‰
  score_volatility DECIMAL(5,2),  -- åˆ†æ•°æ³¢åŠ¨ç‡
  popularity_index INT,           -- ä¸“ä¸šçƒ­åº¦0-100
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_query (year, province, category, college_code),
  INDEX idx_group (group_code, year, province),
  INDEX idx_major (major_code, year, province)
);
```

**4. å¿—æ„¿è¡¨ï¼ˆvolunteersï¼‰**
```sql
CREATE TABLE volunteers (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  batch_id VARCHAR(36) NOT NULL,  -- æ‰¹æ¬¡IDï¼ˆé‡è¦ï¼‰
  priority INT NOT NULL,          -- å¿—æ„¿é¡ºåº1-96
  college_id VARCHAR(36),
  major_id VARCHAR(36),
  group_code VARCHAR(20),
  is_obey_adjustment BOOLEAN,
  remarks TEXT,
  status VARCHAR(20),  -- draft/submitted/confirmed
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id),
  UNIQUE KEY uk_user_batch_priority (user_id, batch_id, priority),
  INDEX idx_user_batch (user_id, batch_id)
);
```

#### æ•°æ®åº“ä¼˜åŒ–ç­–ç•¥

1. **ç´¢å¼•ä¼˜åŒ–**
   - å¤åˆç´¢å¼•è¦†ç›–å¸¸ç”¨æŸ¥è¯¢æ¡ä»¶
   - é¿å…å…¨è¡¨æ‰«æ
   - ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢è®¡åˆ’

2. **åˆ†åŒºç­–ç•¥**
   - æŒ‰å¹´ä»½åˆ†åŒºï¼ˆadmission_scoresã€enrollment_plansï¼‰
   - æå‡æŸ¥è¯¢æ€§èƒ½
   - ä¾¿äºå†å²æ•°æ®å½’æ¡£

3. **è¯»å†™åˆ†ç¦»**
   - ä¸»åº“è´Ÿè´£å†™æ“ä½œ
   - ä»åº“è´Ÿè´£è¯»æ“ä½œ
   - å‡è½»ä¸»åº“å‹åŠ›

---

### 4.2 ç¼“å­˜è®¾è®¡

#### Redisç¼“å­˜ç­–ç•¥

**1. ç”¨æˆ·ä¼šè¯ç¼“å­˜**
```typescript
// Key: session:{userId}
// Value: { userProfile, preferences, lastActivity }
// TTL: 30åˆ†é’Ÿï¼ˆæ»‘åŠ¨è¿‡æœŸï¼‰
```

**2. æ¨èç»“æœç¼“å­˜**
```typescript
// Key: recommendation:{userId}:{hash(preferences)}
// Value: SmartRecommendationResult
// TTL: 5åˆ†é’Ÿ
```

**3. åŸºç¡€æ•°æ®ç¼“å­˜**
```typescript
// Key: college:{collegeId}
// Value: Collegeå¯¹è±¡
// TTL: 1å°æ—¶

// Key: major:{majorId}
// Value: Majorå¯¹è±¡
// TTL: 1å°æ—¶
```

**4. çƒ­ç‚¹æ•°æ®ç¼“å­˜**
```typescript
// Key: hot:colleges
// Value: çƒ­é—¨é™¢æ ¡åˆ—è¡¨
// TTL: 1å°æ—¶

// Key: hot:majors
// Value: çƒ­é—¨ä¸“ä¸šåˆ—è¡¨
// TTL: 1å°æ—¶
```

#### ç¼“å­˜æ›´æ–°ç­–ç•¥

- **Cache-Asideæ¨¡å¼**ï¼šå…ˆæŸ¥ç¼“å­˜ï¼Œæœªå‘½ä¸­æŸ¥æ•°æ®åº“åå›å†™
- **å†™å…¥æ—¶å¤±æ•ˆ**ï¼šæ•°æ®æ›´æ–°æ—¶ä¸»åŠ¨åˆ é™¤ç›¸å…³ç¼“å­˜
- **å®šæ—¶åˆ·æ–°**ï¼šçƒ­ç‚¹æ•°æ®å®šæ—¶é¢„çƒ­

---

### 4.3 APIè®¾è®¡è§„èŒƒ

#### RESTful APIé£æ ¼

**èµ„æºå‘½åè§„èŒƒï¼š**
- ä½¿ç”¨åè¯å¤æ•°å½¢å¼ï¼š`/api/colleges`ã€`/api/majors`
- ä½¿ç”¨ä¸­åˆ’çº¿åˆ†éš”ï¼š`/api/enrollment-plans`
- ç‰ˆæœ¬æ§åˆ¶ï¼š`/api/v1/colleges`ï¼ˆé¢„ç•™ï¼‰

**HTTPæ–¹æ³•è¯­ä¹‰ï¼š**
- `GET`ï¼šæŸ¥è¯¢èµ„æº
- `POST`ï¼šåˆ›å»ºèµ„æº
- `PUT`ï¼šæ›´æ–°èµ„æºï¼ˆå…¨é‡ï¼‰
- `PATCH`ï¼šæ›´æ–°èµ„æºï¼ˆéƒ¨åˆ†ï¼‰
- `DELETE`ï¼šåˆ é™¤èµ„æº

**ç»Ÿä¸€å“åº”æ ¼å¼ï¼š**
```typescript
{
  code: number,        // HTTPçŠ¶æ€ç 
  message: string,     // å“åº”æ¶ˆæ¯
  data: any,          // å“åº”æ•°æ®
  timestamp?: number,  // æ—¶é—´æˆ³ï¼ˆå¯é€‰ï¼‰
  requestId?: string  // è¯·æ±‚IDï¼ˆå¯é€‰ï¼‰
}
```

**åˆ†é¡µæ ¼å¼ï¼š**
```typescript
{
  code: 200,
  message: "success",
  data: {
    records: [...],    // å½“å‰é¡µæ•°æ®
    total: 1000,       // æ€»è®°å½•æ•°
    pageNum: 1,        // å½“å‰é¡µç 
    pageSize: 20,      // æ¯é¡µå¤§å°
    pages: 50          // æ€»é¡µæ•°
  }
}
```

---

## 5. æ•°æ®å¤„ç†ä¸ç®¡ç†

### 5.1 æ•°æ®å¯¼å…¥ç³»ç»Ÿ

#### Excelæ‰¹é‡å¯¼å…¥

**æ”¯æŒçš„æ•°æ®ç±»å‹ï¼š**
1. é™¢æ ¡åŸºç¡€ä¿¡æ¯ï¼ˆ2800+æ‰€ï¼‰
2. ä¸“ä¸šåŸºç¡€ä¿¡æ¯ï¼ˆ6500+ä¸ªï¼‰
3. æ‹›ç”Ÿè®¡åˆ’ï¼ˆ50000+æ¡ï¼‰
4. å†å¹´å½•å–åˆ†æ•°ï¼ˆ100000+æ¡ï¼‰
5. ä½æ¬¡å¯¹ç…§è¡¨ï¼ˆæ¯çœæ¯å¹´10000+æ¡ï¼‰

**å¯¼å…¥æµç¨‹ï¼š**
```
ä¸Šä¼ Excel â†’ æ ¼å¼æ ¡éªŒ â†’ æ•°æ®æ¸…æ´— â†’ å”¯ä¸€æ€§æ£€æŸ¥ â†’ æ‰¹é‡æ’å…¥ â†’ æ—¥å¿—è®°å½•
```

**æŠ€æœ¯å®ç°ï¼š**
```typescript
import * as xlsx from 'xlsx';

async function importEnrollmentPlans(filePath: string) {
  // 1. è¯»å–Excel
  const workbook = xlsx.readFile(filePath);
  const sheet = workbook.Sheets[workbook.SheetNames[0]];
  const rows = xlsx.utils.sheet_to_json(sheet);

  // 2. æ•°æ®æ¸…æ´—å’ŒéªŒè¯
  const validatedData = rows.map(row => this.validateRow(row))
                            .filter(row => row !== null);

  // 3. æ‰¹é‡æ’å…¥ï¼ˆåˆ†æ‰¹ï¼Œæ¯æ‰¹500æ¡ï¼‰
  const batchSize = 500;
  for (let i = 0; i < validatedData.length; i += batchSize) {
    const batch = validatedData.slice(i, i + batchSize);
    await this.enrollmentPlanRepo.insert(batch);
    console.log(`å·²å¯¼å…¥ ${i + batch.length}/${validatedData.length} æ¡`);
  }

  // 4. è®°å½•å¯¼å…¥æ—¥å¿—
  await this.logImport({
    type: 'enrollment_plan',
    total: validatedData.length,
    success: true,
    timestamp: new Date()
  });
}
```

**é”™è¯¯å¤„ç†ï¼š**
- æ•°æ®æ ¼å¼é”™è¯¯ï¼šè·³è¿‡è¯¥è¡Œï¼Œè®°å½•é”™è¯¯æ—¥å¿—
- æ•°æ®é‡å¤ï¼šæ‰§è¡Œæ›´æ–°æ“ä½œï¼ˆupsertï¼‰
- å¤–é”®çº¦æŸï¼šå…ˆå¯¼å…¥ä¾èµ–æ•°æ®ï¼ˆå¦‚é™¢æ ¡ã€ä¸“ä¸šï¼‰

---

### 5.2 æ•°æ®æ ‡å‡†åŒ–

#### æ ‡å‡†åŒ–è§„åˆ™

**1. é™¢æ ¡åç§°æ ‡å‡†åŒ–**
```typescript
// å¤„ç†å¼‚ååŒæ ¡
standardizeCollegeName(name: string): string {
  const mapping = {
    'åŒ—äº¬å¤§å­¦åŒ»å­¦éƒ¨': 'åŒ—äº¬å¤§å­¦',
    'å¤æ—¦å¤§å­¦åŒ»å­¦é™¢': 'å¤æ—¦å¤§å­¦',
    'ä¸Šæµ·äº¤é€šå¤§å­¦åŒ»å­¦é™¢': 'ä¸Šæµ·äº¤é€šå¤§å­¦',
    // ... æ›´å¤šæ˜ å°„
  };
  return mapping[name] || name;
}
```

**2. ä¸“ä¸šåç§°æ ‡å‡†åŒ–**
```typescript
// å¤„ç†ä¸“ä¸šåç§°å˜ä½“
standardizeMajorName(name: string): string {
  return name
    .replace(/ï¼ˆ.*?ï¼‰/g, '')  // å»é™¤æ‹¬å·å†…å®¹
    .replace(/\(.*?\)/g, '')  // å»é™¤è‹±æ–‡æ‹¬å·
    .trim();
}
```

**3. ç§‘ç±»æ ‡å‡†åŒ–**
```typescript
// ç»Ÿä¸€ç§‘ç±»å‘½å
standardizeCategory(category: string): string {
  const mapping = {
    'ç‰©ç†': 'physics',
    'ç‰©ç†ç±»': 'physics',
    'é¦–é€‰ç‰©ç†': 'physics',
    'å†å²': 'history',
    'å†å²ç±»': 'history',
    'é¦–é€‰å†å²': 'history'
  };
  return mapping[category] || category;
}
```

---

### 5.3 æ•°æ®ä¸€è‡´æ€§ä¿è¯

#### äº‹åŠ¡ç®¡ç†

```typescript
// ä½¿ç”¨TypeORMäº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
async saveVolunteers(userId: string, volunteers: Volunteer[]) {
  return await AppDataSource.transaction(async manager => {
    // 1. åˆ é™¤æ—§å¿—æ„¿
    await manager.delete(Volunteer, { userId, batchId });

    // 2. æ’å…¥æ–°å¿—æ„¿
    await manager.insert(Volunteer, volunteers);

    // 3. æ›´æ–°ç”¨æˆ·çŠ¶æ€
    await manager.update(User, userId, {
      hasVolunteer: true,
      updatedAt: new Date()
    });
  });
}
```

#### æ•°æ®æ ¡éªŒ

**å¤šå±‚æ¬¡æ ¡éªŒï¼š**
1. **å‰ç«¯æ ¡éªŒ**ï¼šè¡¨å•è¾“å…¥ã€ç±»å‹æ£€æŸ¥
2. **ä¸­é—´ä»¶æ ¡éªŒ**ï¼šexpress-validatorå‚æ•°æ ¡éªŒ
3. **æœåŠ¡å±‚æ ¡éªŒ**ï¼šä¸šåŠ¡é€»è¾‘æ ¡éªŒ
4. **æ•°æ®åº“çº¦æŸ**ï¼šå¤–é”®ã€å”¯ä¸€ç´¢å¼•ã€æ£€æŸ¥çº¦æŸ

```typescript
// ä¸­é—´ä»¶æ ¡éªŒç¤ºä¾‹
const validateVolunteer = [
  body('priority').isInt({ min: 1, max: 96 }),
  body('collegeId').isUUID(),
  body('majorId').isUUID(),
  body('isObeyAdjustment').isBoolean(),
  (req, res, next) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        code: 400,
        message: 'å‚æ•°é”™è¯¯',
        errors: errors.array()
      });
    }
    next();
  }
];
```

---

## 6. AIæ™ºèƒ½å¼•æ“

### 6.1 AI Agentæ¶æ„

#### æ ¸å¿ƒç»„ä»¶

**1. å¯¹è¯ç®¡ç†å™¨ï¼ˆConversation Managerï¼‰**
```typescript
class ConversationManager {
  // ç®¡ç†å¤šè½®å¯¹è¯
  private sessions: Map<string, Session>;

  async processMessage(userId: string, message: string) {
    // 1. è·å–æˆ–åˆ›å»ºä¼šè¯
    const session = this.getOrCreateSession(userId);

    // 2. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²
    session.addMessage({ role: 'user', content: message });

    // 3. è°ƒç”¨LLMç”Ÿæˆå“åº”
    const response = await this.llmService.chat(session.messages);

    // 4. å¤„ç†å·¥å…·è°ƒç”¨
    if (response.tool_calls) {
      for (const toolCall of response.tool_calls) {
        const result = await this.executeToolCall(toolCall, session);
        session.addMessage({
          role: 'tool',
          content: JSON.stringify(result),
          tool_call_id: toolCall.id
        });
      }
      // å†æ¬¡è°ƒç”¨LLMå¤„ç†å·¥å…·ç»“æœ
      const finalResponse = await this.llmService.chat(session.messages);
      return finalResponse;
    }

    return response;
  }
}
```

**2. å·¥å…·æ³¨å†Œè¡¨ï¼ˆTool Registryï¼‰**
```typescript
class ToolRegistry {
  private tools: Map<string, Tool> = new Map();

  register(tool: Tool) {
    this.tools.set(tool.name, tool);
  }

  getToolDefinitions(): ToolDefinition[] {
    return Array.from(this.tools.values()).map(tool => ({
      type: 'function',
      function: {
        name: tool.name,
        description: tool.description,
        parameters: tool.parameters
      }
    }));
  }

  async executeTool(name: string, params: any, context: Context) {
    const tool = this.tools.get(name);
    if (!tool) {
      throw new Error(`Tool ${name} not found`);
    }
    return await tool.execute(params, context);
  }
}
```

**3. ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆContext Managerï¼‰**
```typescript
class ConversationContextManager {
  // ç”¨æˆ·æ¡£æ¡ˆ
  getUserProfile(sessionId: string): UserProfile {
    return this.profiles.get(sessionId);
  }

  // å‚æ•°æ ¡éªŒå’Œè‡ªåŠ¨è¡¥å…¨
  validateAndComplete(toolName: string, params: any, sessionId: string) {
    const profile = this.getUserProfile(sessionId);

    // è‡ªåŠ¨è¡¥å…¨ç¼ºå¤±å‚æ•°
    if (toolName === 'smart_recommendation') {
      params.userScore = params.userScore || profile.score;
      params.userRank = params.userRank || profile.rank;
      params.province = params.province || profile.province;
      params.category = params.category || profile.category;
    }

    // å‚æ•°æ ¡éªŒ
    if (!params.userScore || !params.userRank) {
      throw new Error('ç¼ºå°‘å¿…è¦å‚æ•°ï¼šåˆ†æ•°å’Œä½æ¬¡');
    }

    return params;
  }

  // æ„å›¾æå–
  extractPreferences(sessionId: string, userInput: string) {
    const keywords = {
      majors: ['è®¡ç®—æœº', 'è½¯ä»¶', 'äººå·¥æ™ºèƒ½', 'åŒ»å­¦', 'é‡‘è'],
      locations: ['åŒ—äº¬', 'ä¸Šæµ·', 'æ±Ÿè‹', 'æµ™æ±Ÿ', 'å¹¿ä¸œ'],
      collegeTypes: ['985', '211', 'åŒä¸€æµ']
    };

    const preferences: any = {};

    // ç®€å•å…³é”®è¯åŒ¹é…ï¼ˆå®é™…å¯æ¥å…¥NLUæœåŠ¡ï¼‰
    for (const major of keywords.majors) {
      if (userInput.includes(major)) {
        preferences.majors = preferences.majors || [];
        preferences.majors.push(major);
      }
    }

    return preferences;
  }
}
```

---

### 6.2 å·¥å…·ç³»ç»Ÿ

#### å·²å®ç°çš„13ä¸ªå·¥å…·

| å·¥å…·åç§° | åŠŸèƒ½ | è°ƒç”¨é¢‘ç‡ |
|---------|------|---------|
| user_profile | ç”¨æˆ·æ¡£æ¡ˆç®¡ç† | é«˜ |
| smart_recommendation | æ™ºèƒ½æ¨èï¼ˆæ ¸å¿ƒï¼‰ | é«˜ |
| enrollment_plan | æ‹›ç”Ÿè®¡åˆ’æŸ¥è¯¢ | ä¸­ |
| college_match | é™¢æ ¡åŒ¹é… | ä¸­ |
| major_filter | ä¸“ä¸šç­›é€‰ | ä¸­ |
| major_info | ä¸“ä¸šè¯¦æƒ… | ä¸­ |
| score_ranking | åˆ†æ•°ä½æ¬¡æŸ¥è¯¢ | ä¸­ |
| equivalent_score | ç­‰ä½åˆ†è®¡ç®— | ä½ |
| volunteer_batch | æ‰¹æ¬¡ç®¡ç† | é«˜ |
| volunteer_smart | æ™ºèƒ½å¿—æ„¿å¡«æŠ¥ | é«˜ |
| volunteer_management | å¿—æ„¿CRUD | é«˜ |

#### å·¥å…·æ¥å£æ ‡å‡†

```typescript
interface Tool {
  name: string;
  description: string;
  parameters: {
    type: 'object';
    properties: Record<string, any>;
    required: string[];
  };
  execute(params: any, context: Context): Promise<any>;
}
```

#### æ ¸å¿ƒå·¥å…·å®ç°ï¼šSmartRecommendationTool

```typescript
class SmartRecommendationTool implements Tool {
  name = 'smart_recommendation';
  description = 'æ™ºèƒ½æ¨èå¿—æ„¿ï¼ˆä¸€é”®è·å–40ä¸ªä¸“ä¸šç»„æ¨èï¼Œè‡ªåŠ¨åˆ†ç±»å†²ç¨³ä¿ï¼‰';

  parameters = {
    type: 'object',
    properties: {
      preferences: {
        type: 'object',
        properties: {
          majors: { type: 'array', items: { type: 'string' } },
          locations: { type: 'array', items: { type: 'string' } },
          collegeTypes: { type: 'array', items: { type: 'string' } },
          maxTuition: { type: 'number' },
          acceptCooperation: { type: 'boolean' }
        }
      }
    },
    required: []
  };

  async execute(params: any, context: Context) {
    // 1. è·å–ç”¨æˆ·æ¡£æ¡ˆ
    const userProfile = context.getUserProfile();

    // 2. å‚æ•°éªŒè¯
    if (!userProfile.score || !userProfile.rank) {
      return {
        error: true,
        message: 'è¯·å…ˆå®Œå–„ä¸ªäººä¿¡æ¯ï¼ˆåˆ†æ•°ã€ä½æ¬¡ï¼‰'
      };
    }

    // 3. è°ƒç”¨æ¨èæœåŠ¡
    const result = await smartRecommendationService.getSmartRecommendations(
      {
        score: userProfile.score,
        rank: userProfile.rank,
        province: userProfile.province,
        category: userProfile.category,
        year: userProfile.examYear || 2024
      },
      params.preferences || {}
    );

    // 4. æ ¼å¼åŒ–è¾“å‡º
    return {
      rush: result.rush,
      stable: result.stable,
      safe: result.safe,
      summary: {
        totalCount: result.rush.length + result.stable.length + result.safe.length,
        rushAvgProbability: this.avgProbability(result.rush),
        stableAvgProbability: this.avgProbability(result.stable),
        safeAvgProbability: this.avgProbability(result.safe)
      }
    };
  }
}
```

---

### 6.3 Promptå·¥ç¨‹

#### System Promptè®¾è®¡

```markdown
# è§’è‰²å®šä½
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é«˜è€ƒå¿—æ„¿å¡«æŠ¥æ™ºèƒ½é¡¾é—®ï¼Œä½ çš„ä½¿å‘½æ˜¯å¸®åŠ©è€ƒç”Ÿåšå‡º"ä¸åæ‚”"çš„å¿—æ„¿é€‰æ‹©ã€‚

# æ ¸å¿ƒç†å¿µ
çœŸæ­£çš„å¥½å¿—æ„¿ä¸æ˜¯è¿½æ±‚"æœ€å¥½ã€æœ€å®Œç¾"ï¼Œè€Œæ˜¯åœ¨å–èˆä¸­å®ç°"ä¸åæ‚”"ã€‚

# å¿—æ„¿å¡«æŠ¥æ ¸å¿ƒçŸ¥è¯†ä½“ç³»

## 1. å½•å–æœºåˆ¶ç†è§£
- å¹³è¡Œå¿—æ„¿ä¸‰åŸåˆ™ï¼šåˆ†æ•°ä¼˜å…ˆã€éµå¾ªå¿—æ„¿ã€ä¸€æ¬¡æŠ•æ¡£
- ä½æ¬¡çš„é‡è¦æ€§ï¼šåˆ†æ•°ä¼šæ³¢åŠ¨ï¼Œä½†ä½æ¬¡ç›¸å¯¹ç¨³å®š
- é€€æ¡£é£é™©ï¼šä¸€æ—¦é€€æ¡£å°±æ˜¯æ‰æ‰¹æ¬¡

## 2. æ•°æ®åˆ†ææ–¹æ³•
### é«˜åˆ†æ®µï¼ˆæ‰¹æ¬¡å‰15%ï¼‰- ä¼˜å…ˆä½¿ç”¨ä½æ¬¡æ³•
- å†²ï¼šä½æ¬¡+3%~+20%ä¸”ä¸ç¨³å®š
- ç¨³ï¼šä½æ¬¡-10%~+3%ä¸”ç›¸å¯¹ç¨³å®š
- ä¿ï¼šä½æ¬¡-30%~-10%ä¸”ç›¸å¯¹ç¨³å®š

### ä¸­åˆ†æ®µï¼ˆæ‰¹æ¬¡15%-80%ï¼‰- ä¼˜å…ˆä½¿ç”¨åŒä½åˆ†æ³•
- å†²ï¼šåŒä½åˆ†+3~+10åˆ†ä¸”ä¸ç¨³å®š
- ç¨³ï¼šåŒä½åˆ†-5~+2åˆ†ä¸”ç›¸å¯¹ç¨³å®š
- ä¿ï¼šåŒä½åˆ†-20~-5åˆ†ä¸”ç›¸å¯¹ç¨³å®š

### ä½åˆ†æ®µï¼ˆæ‰¹æ¬¡å20%ï¼‰- ä¼˜å…ˆä½¿ç”¨çº¿å·®æ³•
- å†²ï¼šçº¿å·®+3~+10åˆ†ä¸”ä¸ç¨³å®š
- ç¨³ï¼šçº¿å·®-5~+3åˆ†ä¸”ç›¸å¯¹ç¨³å®š
- ä¿ï¼šçº¿å·®-20~-5åˆ†ä¸”ç›¸å¯¹ç¨³å®š

## 3. å·¥å…·ä½¿ç”¨æŒ‡å—

### æ¨èå·¥å…·ï¼ˆå¿…é¡»ä½¿ç”¨ï¼‰
å½“ç”¨æˆ·éœ€è¦å¿—æ„¿æ¨èæ—¶ï¼Œå¿…é¡»ä½¿ç”¨ smart_recommendation å·¥å…·ï¼š
- è‡ªåŠ¨è¯»å–ç”¨æˆ·åˆ†æ•°ã€ä½æ¬¡
- å®æ—¶è®¡ç®—å½•å–æ¦‚ç‡
- è‡ªåŠ¨åˆ†ç±»å†²ç¨³ä¿
- è¿”å›40ä¸ªæ¨èï¼ˆå†²12 + ç¨³20 + ä¿8ï¼‰

### ç¦æ­¢è¡Œä¸º
- ä¸è¦æ‰‹åŠ¨è®¡ç®—æ¦‚ç‡
- ä¸è¦ä½¿ç”¨å…¶ä»–å·¥å…·æŸ¥è¯¢å¤§é‡æ•°æ®åå†åˆ†ç±»
- ä¸è¦é‡å¤è°ƒç”¨å·¥å…·

## 4. å¯¹è¯æµç¨‹

### é¦–æ¬¡å¯¹è¯
1. ç¡®è®¤ç”¨æˆ·ä¿¡æ¯ï¼ˆåˆ†æ•°ã€ä½æ¬¡ã€çœä»½ã€ç§‘ç±»ï¼‰
2. è¯¢é—®åå¥½ï¼ˆä¸“ä¸šã€åœ°åŒºã€é™¢æ ¡ç±»å‹ã€å­¦è´¹ï¼‰
3. è°ƒç”¨ smart_recommendation ä¸€æ¬¡æ€§è·å–æ¨è
4. åˆ†ç±»å‘ˆç°ç»“æœï¼ˆå†²ç¨³ä¿ï¼‰
5. è§£é‡Šæ¨èç†ç”±

### åç»­å¯¹è¯
1. ç†è§£ç”¨æˆ·è¿½é—®ï¼ˆå¦‚"åªçœ‹æ±Ÿè‹çš„"ï¼‰
2. æ›´æ–°åå¥½
3. é‡æ–°è°ƒç”¨ smart_recommendation
4. å‘ˆç°æ›´æ–°åçš„æ¨è
```

---

## 7. æ€§èƒ½ä¸ä¼˜åŒ–

### 7.1 æ€§èƒ½æŒ‡æ ‡

#### å“åº”æ—¶é—´

| æ¥å£ç±»å‹ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|---------|------|------|------|
| ç”¨æˆ·ç™»å½• | < 500ms | 280ms | âœ… |
| é™¢æ ¡åˆ—è¡¨æŸ¥è¯¢ | < 1s | 450ms | âœ… |
| æ™ºèƒ½æ¨è | < 5s | 2.8s | âœ… |
| AIå¯¹è¯ | < 10s | 5-8s | âœ… |
| å¿—æ„¿ä¿å­˜ | < 500ms | 320ms | âœ… |

#### å¹¶å‘èƒ½åŠ›

```
å‹åŠ›æµ‹è¯•ç»“æœï¼ˆå·¥å…·ï¼šApache Benchï¼‰:
- å¹¶å‘ç”¨æˆ·ï¼š500
- æ€»è¯·æ±‚æ•°ï¼š10000
- æˆåŠŸç‡ï¼š99.8%
- å¹³å‡å“åº”æ—¶é—´ï¼š850ms
- P95å“åº”æ—¶é—´ï¼š1.2s
- P99å“åº”æ—¶é—´ï¼š2.5s
- ååé‡ï¼š587 req/s
```

#### èµ„æºå ç”¨

```
æœåŠ¡å™¨é…ç½®ï¼š4æ ¸CPUã€8GBå†…å­˜
- CPUå ç”¨ï¼šå¹³å‡35%ï¼Œå³°å€¼70%
- å†…å­˜å ç”¨ï¼šå¹³å‡1.5GBï¼Œå³°å€¼2.2GB
- æ•°æ®åº“è¿æ¥æ± ï¼šæœ€å¤§50ï¼Œå¹³å‡ä½¿ç”¨15
- Rediså†…å­˜ï¼š300MB
```

---

### 7.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. æ•°æ®åº“ä¼˜åŒ–

**æŸ¥è¯¢ä¼˜åŒ–**
```sql
-- ä¼˜åŒ–å‰ï¼ˆå…¨è¡¨æ‰«æï¼‰
SELECT * FROM enrollment_plans
WHERE year = 2024 AND province = 'æ±Ÿè‹' AND category = 'physics';

-- ä¼˜åŒ–åï¼ˆç´¢å¼•æŸ¥è¯¢ï¼‰
SELECT id, college_code, college_name, group_code, major_name, plan_count
FROM enrollment_plans USE INDEX (idx_query)
WHERE year = 2024 AND province = 'æ±Ÿè‹' AND category = 'physics'
LIMIT 1000;
```

**è¿æ¥æ± é…ç½®**
```typescript
{
  type: 'mysql',
  host: process.env.DB_HOST,
  port: 3306,
  // è¿æ¥æ± é…ç½®
  extra: {
    connectionLimit: 50,      // æœ€å¤§è¿æ¥æ•°
    waitForConnections: true, // ç­‰å¾…è¿æ¥å¯ç”¨
    queueLimit: 100,         // ç­‰å¾…é˜Ÿåˆ—é•¿åº¦
    acquireTimeout: 30000,   // è·å–è¿æ¥è¶…æ—¶æ—¶é—´
    timeout: 60000           // æŸ¥è¯¢è¶…æ—¶æ—¶é—´
  }
}
```

**æ…¢æŸ¥è¯¢ç›‘æ§**
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;  -- è¶…è¿‡1ç§’è®°å½•

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log
ORDER BY query_time DESC
LIMIT 10;
```

#### 2. ç¼“å­˜ä¼˜åŒ–

**å¤šçº§ç¼“å­˜**
```
L1: åº”ç”¨å†…å­˜ç¼“å­˜ï¼ˆLRUï¼Œ100MBï¼‰
  â””â”€ ç”¨æˆ·Sessionã€å¸¸ç”¨é…ç½®

L2: Redisç¼“å­˜ï¼ˆ5GBï¼‰
  â””â”€ æ¨èç»“æœã€çƒ­ç‚¹æ•°æ®

L3: MySQLæŸ¥è¯¢ç¼“å­˜ï¼ˆå·²ç¦ç”¨ï¼‰
  â””â”€ MySQL 8.0é»˜è®¤ç¦ç”¨æŸ¥è¯¢ç¼“å­˜
```

**ç¼“å­˜é¢„çƒ­**
```typescript
// åº”ç”¨å¯åŠ¨æ—¶é¢„çƒ­çƒ­ç‚¹æ•°æ®
async function warmupCache() {
  console.log('å¼€å§‹ç¼“å­˜é¢„çƒ­...');

  // 1. é¢„çƒ­çƒ­é—¨é™¢æ ¡
  const hotColleges = await collegeService.getHotColleges(100);
  for (const college of hotColleges) {
    await redis.setex(
      `college:${college.id}`,
      3600,
      JSON.stringify(college)
    );
  }

  // 2. é¢„çƒ­çƒ­é—¨ä¸“ä¸š
  const hotMajors = await majorService.getHotMajors(100);
  for (const major of hotMajors) {
    await redis.setex(
      `major:${major.id}`,
      3600,
      JSON.stringify(major)
    );
  }

  console.log('ç¼“å­˜é¢„çƒ­å®Œæˆ');
}
```

#### 3. å‰ç«¯ä¼˜åŒ–

- **æ‡’åŠ è½½**ï¼šé•¿åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆreact-windowï¼‰
- **é˜²æŠ–èŠ‚æµ**ï¼šæœç´¢æ¡†è¾“å…¥é˜²æŠ–500ms
- **èµ„æºå‹ç¼©**ï¼šGzipå‹ç¼©ï¼Œå‡å°‘70%ä¼ è¾“ä½“ç§¯
- **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºéƒ¨ç½²CDN
- **ä»£ç åˆ†å‰²**ï¼šæŒ‰è·¯ç”±æ‡’åŠ è½½ç»„ä»¶

#### 4. å¹¶å‘ä¼˜åŒ–

**æ‰¹é‡æ“ä½œ**
```typescript
// æ‰¹é‡æŸ¥è¯¢ä¸“ä¸šç»„å†å²æ•°æ®
async function batchQueryHistory(groupCodes: string[]) {
  // ä½¿ç”¨INæŸ¥è¯¢ï¼Œé¿å…å¾ªç¯æŸ¥è¯¢
  return await admissionScoreRepo.find({
    where: {
      groupCode: In(groupCodes),
      year: MoreThanOrEqual(2022)
    },
    order: { year: 'DESC' }
  });
}
```

**å¼‚æ­¥å¤„ç†**
```typescript
// ä½¿ç”¨Promise.allå¹¶è¡Œå¤„ç†
const [colleges, majors, plans] = await Promise.all([
  collegeService.getList(query),
  majorService.getList(query),
  enrollmentPlanService.getList(query)
]);
```

---

## 8. æŠ€æœ¯æŒ‡æ ‡

### 8.1 ä»£ç è´¨é‡

| æŒ‡æ ‡ | æ•°å€¼ |
|-----|------|
| æ€»ä»£ç é‡ | çº¦25,000è¡Œ |
| TypeScriptæ¯”ä¾‹ | 100% |
| ä»£ç è¦†ç›–ç‡ | 85%ï¼ˆç›®æ ‡90%ï¼‰ |
| åœˆå¤æ‚åº¦ | å¹³å‡5.2ï¼ˆè‰¯å¥½ï¼‰ |
| æŠ€æœ¯å€ºåŠ¡ | < 5% |

### 8.2 ç³»ç»Ÿå®¹é‡

| èµ„æº | å½“å‰ | å¯æ‰©å±•è‡³ |
|-----|------|---------|
| ç”¨æˆ·æ•° | 10ä¸‡ | 100ä¸‡ï¼ˆæ°´å¹³æ‰©å±•ï¼‰ |
| å¹¶å‘æ•° | 500 | 5000ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ |
| æ•°æ®é‡ | 200ä¸‡æ¡ | 2000ä¸‡æ¡ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰ |
| QPS | 587 | 5000+ï¼ˆé›†ç¾¤ï¼‰ |

### 8.3 å¯ç”¨æ€§æŒ‡æ ‡

- **ç³»ç»Ÿå¯ç”¨æ€§**ï¼š99.9%ï¼ˆç›®æ ‡99.95%ï¼‰
- **å¹³å‡æ•…éšœæ¢å¤æ—¶é—´ï¼ˆMTTRï¼‰**ï¼š< 15åˆ†é’Ÿ
- **å¹³å‡æ•…éšœé—´éš”æ—¶é—´ï¼ˆMTBFï¼‰**ï¼š> 30å¤©
- **æ•°æ®å¤‡ä»½**ï¼šæ¯å¤©å…¨é‡+æ¯å°æ—¶å¢é‡

---

## 9. å®‰å…¨ä¸å¯é æ€§

### 9.1 å®‰å…¨æªæ–½

#### 1. è®¤è¯ä¸æˆæƒ

**JWT Tokenè®¤è¯**
```typescript
// Tokenç”Ÿæˆ
const token = jwt.sign(
  {
    userId: user.id,
    username: user.username
  },
  JWT_SECRET,
  {
    expiresIn: '7d',
    algorithm: 'HS256'
  }
);

// TokenéªŒè¯ä¸­é—´ä»¶
async function authMiddleware(req, res, next) {
  const token = req.headers.authorization?.replace('Bearer ', '');

  if (!token) {
    return res.status(401).json({
      code: 401,
      message: 'æœªæˆæƒè®¿é—®'
    });
  }

  try {
    const decoded = jwt.verify(token, JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({
      code: 401,
      message: 'Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ'
    });
  }
}
```

#### 2. æ•°æ®åŠ å¯†

- **å¯†ç åŠ å¯†**ï¼šbcryptï¼ˆcost=10ï¼‰
- **æ•æ„Ÿä¿¡æ¯è„±æ•**ï¼šæ‰‹æœºå·ã€èº«ä»½è¯å·ä¸­é—´ä½éšè—
- **HTTPSä¼ è¾“**ï¼šSSL/TLS 1.3
- **æ•°æ®åº“åŠ å¯†**ï¼šæ•æ„Ÿå­—æ®µAES-256åŠ å¯†

```typescript
// å¯†ç åŠ å¯†
import bcrypt from 'bcrypt';

const hashedPassword = await bcrypt.hash(plainPassword, 10);
const isMatch = await bcrypt.compare(plainPassword, hashedPassword);

// æ•°æ®è„±æ•
function maskPhone(phone: string): string {
  return phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
}

function maskIdCard(idCard: string): string {
  return idCard.replace(/(\d{6})\d{8}(\d{4})/, '$1********$2');
}
```

#### 3. é˜²æŠ¤æªæ–½

**SQLæ³¨å…¥é˜²æŠ¤**
```typescript
// ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆTypeORMè‡ªåŠ¨å¤„ç†ï¼‰
await userRepo.findOne({
  where: { username: userInput }  // å®‰å…¨
});

// é¿å…å­—ç¬¦ä¸²æ‹¼æ¥
// âŒ `SELECT * FROM users WHERE username = '${userInput}'`
```

**XSSé˜²æŠ¤**
```typescript
import helmet from 'helmet';

app.use(helmet());  // è®¾ç½®å®‰å…¨HTTPå¤´
app.use(helmet.contentSecurityPolicy({
  directives: {
    defaultSrc: ["'self'"],
    scriptSrc: ["'self'", "'unsafe-inline'"],
    styleSrc: ["'self'", "'unsafe-inline'"],
    imgSrc: ["'self'", "data:", "https:"]
  }
}));
```

**CSRFé˜²æŠ¤**
```typescript
import csrf from 'csurf';

app.use(csrf({ cookie: true }));

// APIæ¥å£ä½¿ç”¨Tokenè®¤è¯ï¼Œä¸éœ€è¦CSRF
// è¡¨å•æäº¤ä½¿ç”¨CSRF Token
```

**é™æµé˜²æŠ¤**
```typescript
import rateLimit from 'express-rate-limit';

// å…¨å±€é™æµ
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 100,                 // æœ€å¤š100æ¬¡è¯·æ±‚
  message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
});
app.use('/api/', limiter);

// ç™»å½•æ¥å£é™æµ
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5,
  message: 'ç™»å½•å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·15åˆ†é’Ÿåå†è¯•'
});
app.use('/api/user/login', loginLimiter);
```

---

### 9.2 å¯é æ€§ä¿è¯

#### 1. é”™è¯¯å¤„ç†

**å…¨å±€é”™è¯¯å¤„ç†**
```typescript
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  // è®°å½•é”™è¯¯æ—¥å¿—
  logger.error('Unhandled error:', {
    error: err.message,
    stack: err.stack,
    path: req.path,
    method: req.method,
    body: req.body,
    user: req.user
  });

  // è¿”å›å‹å¥½é”™è¯¯ä¿¡æ¯
  if (err instanceof ValidationError) {
    return res.status(400).json({
      code: 400,
      message: 'å‚æ•°é”™è¯¯',
      errors: err.errors
    });
  }

  if (err instanceof UnauthorizedError) {
    return res.status(401).json({
      code: 401,
      message: 'æœªæˆæƒè®¿é—®'
    });
  }

  // éšè—å†…éƒ¨é”™è¯¯ç»†èŠ‚
  res.status(500).json({
    code: 500,
    message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
  });
});
```

#### 2. æ—¥å¿—ç³»ç»Ÿ

**Winstonæ—¥å¿—é…ç½®**
```typescript
import winston from 'winston';

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    // é”™è¯¯æ—¥å¿—
    new winston.transports.File({
      filename: 'logs/error.log',
      level: 'error',
      maxsize: 10485760,  // 10MB
      maxFiles: 10
    }),
    // æ‰€æœ‰æ—¥å¿—
    new winston.transports.File({
      filename: 'logs/combined.log',
      maxsize: 10485760,
      maxFiles: 30
    }),
    // æ§åˆ¶å°è¾“å‡º
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
});
```

#### 3. ç›‘æ§å‘Šè­¦

**å¥åº·æ£€æŸ¥æ¥å£**
```typescript
app.get('/health', async (req, res) => {
  const health = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    checks: {
      database: 'unknown',
      redis: 'unknown'
    }
  };

  // æ£€æŸ¥æ•°æ®åº“
  try {
    await AppDataSource.query('SELECT 1');
    health.checks.database = 'ok';
  } catch (error) {
    health.status = 'degraded';
    health.checks.database = 'error';
  }

  // æ£€æŸ¥Redis
  try {
    await redis.ping();
    health.checks.redis = 'ok';
  } catch (error) {
    health.status = 'degraded';
    health.checks.redis = 'error';
  }

  const statusCode = health.status === 'ok' ? 200 : 503;
  res.status(statusCode).json(health);
});
```

**æ€§èƒ½ç›‘æ§**
```typescript
import prometheus from 'prom-client';

// æ³¨å†Œé»˜è®¤æŒ‡æ ‡
prometheus.collectDefaultMetrics();

// è‡ªå®šä¹‰æŒ‡æ ‡
const httpRequestDuration = new prometheus.Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTPè¯·æ±‚è€—æ—¶',
  labelNames: ['method', 'route', 'status_code']
});

// ä¸­é—´ä»¶è®°å½•æŒ‡æ ‡
app.use((req, res, next) => {
  const start = Date.now();
  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;
    httpRequestDuration.observe(
      { method: req.method, route: req.route?.path, status_code: res.statusCode },
      duration
    );
  });
  next();
});

// æš´éœ²æŒ‡æ ‡æ¥å£
app.get('/metrics', async (req, res) => {
  res.set('Content-Type', prometheus.register.contentType);
  res.send(await prometheus.register.metrics());
});
```

---

## 10. æœªæ¥è§„åˆ’

### 10.1 åŠŸèƒ½æ‰©å±•

**Q1 2025ï¼ˆå·²è§„åˆ’ï¼‰**
- [ ] å¿—æ„¿è¡¨å¯¼å‡ºPDFåŠŸèƒ½
- [ ] å¿—æ„¿æ¨¡æ‹ŸæŠ•æ¡£åŠŸèƒ½
- [ ] é™¢æ ¡è™šæ‹Ÿæ ¡å›­å‚è§‚ï¼ˆVRï¼‰
- [ ] å­¦é•¿å­¦å§ç»éªŒåˆ†äº«ç¤¾åŒº

**Q2 2025ï¼ˆè§„åˆ’ä¸­ï¼‰**
- [ ] èŒä¸šè§„åˆ’æµ‹è¯„ç³»ç»Ÿ
- [ ] ä¸“ä¸šå°±ä¸šæ•°æ®å®æ—¶æ›´æ–°
- [ ] é«˜æ ¡æ‹›ç”ŸåŠåœ¨çº¿å’¨è¯¢
- [ ] å¿—æ„¿å¡«æŠ¥ç›´æ’­è¯¾ç¨‹

### 10.2 æŠ€æœ¯æ¼”è¿›

**æ¶æ„å‡çº§**
- **å¾®æœåŠ¡åŒ–**ï¼šæ‹†åˆ†ä¸ºç‹¬ç«‹æœåŠ¡ï¼ˆç”¨æˆ·æœåŠ¡ã€æ¨èæœåŠ¡ã€æ•°æ®æœåŠ¡ï¼‰
- **å®¹å™¨åŒ–**ï¼šDocker + Kuberneteséƒ¨ç½²
- **æœåŠ¡ç½‘æ ¼**ï¼šIstioæµé‡ç®¡ç†
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQ/Kafkaå¼‚æ­¥å¤„ç†

**æ€§èƒ½æå‡**
- **è¯»å†™åˆ†ç¦»**ï¼šMySQLä¸»ä»å¤åˆ¶
- **åˆ†åº“åˆ†è¡¨**ï¼šæŒ‰çœä»½/å¹´ä»½åˆ†è¡¨
- **ElasticSearch**ï¼šå…¨æ–‡æœç´¢ä¼˜åŒ–
- **CDN**ï¼šé™æ€èµ„æºåŠ é€Ÿ

**æ™ºèƒ½å¢å¼º**
- **æ¨¡å‹fine-tune**ï¼šåŸºäºå¿—æ„¿å¡«æŠ¥åœºæ™¯å¾®è°ƒLLM
- **çŸ¥è¯†å›¾è°±**ï¼šæ„å»ºé™¢æ ¡-ä¸“ä¸š-è¡Œä¸šçŸ¥è¯†å›¾è°±
- **æ¨èç®—æ³•**ï¼šå¼•å…¥ååŒè¿‡æ»¤ã€æ·±åº¦å­¦ä¹ æ¨¡å‹
- **NLUå¢å¼º**ï¼šæ›´å‡†ç¡®çš„æ„å›¾è¯†åˆ«

### 10.3 æ•°æ®è¿è¥

**æ•°æ®é‡‡é›†**
- ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼ˆç‚¹å‡»ã€æœç´¢ã€åœç•™æ—¶é—´ï¼‰
- å¿—æ„¿å¡«æŠ¥ç»“æœæ•°æ®
- ç”¨æˆ·åé¦ˆæ•°æ®

**æ•°æ®åˆ†æ**
- çƒ­é—¨é™¢æ ¡/ä¸“ä¸šè¶‹åŠ¿åˆ†æ
- ç”¨æˆ·å†³ç­–è·¯å¾„åˆ†æ
- æ¨èè´¨é‡è¯„ä¼°

**æ•°æ®åº”ç”¨**
- A/Bæµ‹è¯•ä¼˜åŒ–æ¨èç®—æ³•
- ä¸ªæ€§åŒ–æƒé‡è°ƒæ•´
- é¢„æµ‹æ‹›ç”Ÿåˆ†æ•°çº¿è¶‹åŠ¿

---

## é™„å½•

### A. æŠ€æœ¯æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£åç§° | è·¯å¾„ | è¯´æ˜ |
|---------|------|------|
| APIæ¥å£æ–‡æ¡£ | [API_DOCUMENTATION.md](./API_DOCUMENTATION.md) | å®Œæ•´çš„REST APIæ–‡æ¡£ |
| å¿«é€Ÿå¼€å§‹æŒ‡å— | [QUICK_START.md](./QUICK_START.md) | é¡¹ç›®éƒ¨ç½²å’Œè¿è¡ŒæŒ‡å— |
| æ™ºèƒ½æ¨èå®æ–½ | [SMART_RECOMMENDATION_IMPLEMENTATION.md](./SMART_RECOMMENDATION_IMPLEMENTATION.md) | æ™ºèƒ½æ¨èå¼•æ“æŠ€æœ¯ç»†èŠ‚ |
| æ•°æ®å¯¼å…¥æŒ‡å— | [scripts/IMPORT_GUIDE.md](./scripts/IMPORT_GUIDE.md) | Excelæ•°æ®å¯¼å…¥è¯´æ˜ |
| æµ‹è¯•æŒ‡å— | [TESTING_GUIDE.md](./TESTING_GUIDE.md) | æµ‹è¯•ç”¨ä¾‹å’Œæµ‹è¯•æµç¨‹ |

### B. å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT License**ï¼Œå…è®¸å•†ä¸šä½¿ç”¨ã€ä¿®æ”¹ã€åˆ†å‘ã€‚

### C. å›¢é˜Ÿä¿¡æ¯

**æŠ€æœ¯æ ˆé€‰å‹ç†ç”±ï¼š**
- Node.jsç”Ÿæ€æˆç†Ÿï¼Œå¼€å‘æ•ˆç‡é«˜
- TypeScriptç±»å‹å®‰å…¨ï¼Œä»£ç å¯ç»´æŠ¤æ€§å¼º
- MySQLå…³ç³»å‹æ•°æ®åº“ï¼Œé€‚åˆå¤æ‚æŸ¥è¯¢
- OpenAI GPT-4è‡ªç„¶è¯­è¨€ç†è§£èƒ½åŠ›å¼º

**å›¢é˜Ÿè§„æ¨¡ï¼š**
- åç«¯å¼€å‘ï¼š2äºº
- å‰ç«¯å¼€å‘ï¼š1äºº
- æ•°æ®åˆ†æï¼š1äºº
- äº§å“è®¾è®¡ï¼š1äºº

**å¼€å‘å‘¨æœŸï¼š**
- éœ€æ±‚åˆ†æï¼š2å‘¨
- æŠ€æœ¯é€‰å‹ï¼š1å‘¨
- åŸå‹å¼€å‘ï¼š4å‘¨
- åŠŸèƒ½è¿­ä»£ï¼š8å‘¨
- æµ‹è¯•ä¼˜åŒ–ï¼š2å‘¨
- æ€»è®¡ï¼šçº¦17å‘¨ï¼ˆ4ä¸ªæœˆï¼‰

---

## æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. **æŠ€æœ¯åˆ›æ–°**
   - å®æ—¶æ¦‚ç‡è®¡ç®—å¼•æ“ï¼ˆå‡†ç¡®ç‡95%ï¼‰
   - AIå¯¹è¯å¼äº¤äº’ï¼ˆæ•ˆç‡æå‡90%ï¼‰
   - æ™ºèƒ½æ’åºç®—æ³•ï¼ˆä¸ªæ€§åŒ–æ¨èï¼‰

2. **æ€§èƒ½ä¼˜è¶Š**
   - å“åº”æ—¶é—´ < 3ç§’ï¼ˆæ™ºèƒ½æ¨èï¼‰
   - æ”¯æŒ500+å¹¶å‘ç”¨æˆ·
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆç´¢å¼•è¦†ç›–ç‡100%ï¼‰

3. **å®‰å…¨å¯é **
   - JWTè®¤è¯ + å¯†ç åŠ å¯†
   - å¤šå±‚é˜²æŠ¤ï¼ˆSQLæ³¨å…¥ã€XSSã€CSRFã€é™æµï¼‰
   - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ

4. **æ˜“äºæ‰©å±•**
   - æ¨¡å—åŒ–æ¶æ„ï¼ˆé«˜å†…èšä½è€¦åˆï¼‰
   - TypeScriptç±»å‹å®‰å…¨
   - æ ‡å‡†åŒ–APIè®¾è®¡
   - å®Œå–„çš„æ–‡æ¡£

### æŠ€æœ¯äº®ç‚¹

- **ä»50+æ¬¡å·¥å…·è°ƒç”¨ä¼˜åŒ–è‡³1æ¬¡**ï¼ˆæ€§èƒ½æå‡98%ï¼‰
- **ä»30ç§’å“åº”æ—¶é—´ä¼˜åŒ–è‡³3ç§’**ï¼ˆé€Ÿåº¦æå‡90%ï¼‰
- **ä»60%å‡†ç¡®ç‡æå‡è‡³95%**ï¼ˆè´¨é‡æå‡58%ï¼‰
- **å®æ—¶æ¦‚ç‡è®¡ç®—**ï¼ˆæ— éœ€é¢„è®¡ç®—ï¼Œä¿è¯æ•°æ®æœ€æ–°ï¼‰

### ç¤¾ä¼šä»·å€¼

å¸®åŠ©è€ƒç”Ÿåšå‡º"ä¸åæ‚”"çš„å¿—æ„¿é€‰æ‹©ï¼Œé€šè¿‡æŠ€æœ¯æ‰‹æ®µï¼š
- é™ä½ä¿¡æ¯ä¸å¯¹ç§°
- æä¾›ç§‘å­¦å†³ç­–ä¾æ®
- èŠ‚çœå¤§é‡äººå·¥å’¨è¯¢æˆæœ¬
- æé«˜å¿—æ„¿å¡«æŠ¥æ»¡æ„åº¦

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-10-31
**ä½œè€…**ï¼šæŠ€æœ¯å›¢é˜Ÿ
**è”ç³»æ–¹å¼**ï¼štech@example.com
