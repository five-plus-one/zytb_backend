# 院校数据导入指南

## 概述
本指南介绍如何将包含院校信息的 Excel 文件导入到系统数据库中。

## 准备工作

### 1. Excel 文件格式要求
Excel 文件应包含以下列(表头):

| 列名 | 说明 | 是否必填 | 数据类型 |
|------|------|---------|---------|
| 学校名称 | 院校名称 | 是 | 文本 |
| 新院校名称 | 新的院校名称(如更名) | 否 | 文本 |
| 排名 | 院校排名 | 否 | 数字 |
| 所在省 | 所在省份 | 是 | 文本 |
| 城市 | 所在城市 | 是 | 文本 |
| 类型 | 院校类型(如综合、理工等) | 否 | 文本 |
| 隶属单位 | 主管部门 | 否 | 文本 |
| 是否985 | 是否为985院校 | 否 | 是/否 |
| 是否211 | 是否为211院校 | 否 | 是/否 |
| 一流大学 | 是否为一流大学 | 否 | 是/否 |
| 是否艺术 | 是否为艺术类院校 | 否 | 是/否 |
| 国重/省重 | 国重点或省重点 | 否 | 文本 |
| 本科/专科 | 教育层次 | 否 | 文本 |
| 保研率 | 保研率 | 否 | 数字或百分比 |
| 国家特色专业 | 国家特色专业数量 | 否 | 数字 |
| 省特色专业 | 省级特色专业数量 | 否 | 数字 |
| 是否国重点 | 是否为国家重点 | 否 | 是/否 |
| 世界一流 | 世界一流学科 | 否 | 文本 |
| 是否双一流 | 是否为双一流院校 | 否 | 是/否 |
| 成立时间 | 成立年份 | 否 | 数字 |
| 女生比例 | 女生占比 | 否 | 数字或百分比 |
| 男生比例 | 男生占比 | 否 | 数字或百分比 |
| 招办电话 | 招生办电话 | 否 | 文本 |
| 电子邮箱 | 联系邮箱 | 否 | 文本 |
| 通讯地址 | 通讯地址 | 否 | 文本 |
| 官网 | 官方网站 | 否 | 文本 |
| 评估结果 | 评估结果 | 否 | 文本 |
| 大学简介 | 院校简介 | 否 | 文本 |

### 2. 数据格式说明

- **布尔值**: 可以使用 "是"/"否", "true"/"false", "1"/"0", "yes"/"no"
- **百分比**: 可以使用 "50%" 或 "50" 格式,系统会自动识别
- **数字**: 纯数字格式,如 "985", "2024"
- **文本**: 其他所有文本信息

## 导入步骤

### 步骤 1: 更新数据库表结构

由于添加了新的字段,首先需要更新数据库表结构:

```bash
# 启动开发服务器,TypeORM 会自动同步表结构
npm run dev
```

或者手动运行同步脚本:

```bash
ts-node scripts/syncDatabase.ts
```

### 步骤 2: 执行导入

将 Excel 文件放到合适的位置(如 `data` 目录),然后执行:

```bash
npm run import-colleges <Excel文件路径>
```

示例:
```bash
# 相对路径
npm run import-colleges ./data/colleges.xlsx

# 绝对路径
npm run import-colleges E:/data/colleges.xlsx
```

### 步骤 3: 查看导入结果

导入过程中会显示详细的日志信息:
- 成功导入的记录数
- 失败的记录数
- 详细的错误信息

## 重要说明

### 数据更新策略
- 如果院校名称已存在,将**更新**该记录
- 如果院校名称不存在,将**创建**新记录

### 错误处理
如果某条记录导入失败,会:
1. 显示具体的错误信息和行号
2. 继续导入其他记录
3. 最后汇总显示所有错误

### 必填字段验证
以下字段为必填项,缺少这些字段的记录会被跳过:
- 学校名称
- 所在省
- 城市

## 示例 Excel 文件

```
学校名称  | 所在省  | 城市  | 是否985 | 是否211 | 保研率
北京大学  | 北京市  | 北京  | 是      | 是      | 50%
清华大学  | 北京市  | 北京  | 是      | 是      | 48.5%
```

## 故障排查

### 问题 1: 数据库连接失败
检查 `.env` 文件中的数据库配置:
```env
DB_HOST=localhost
DB_PORT=3307
DB_USER=root
DB_PASSWORD=123456
DB_NAME=volunteer_system
```

### 问题 2: Excel 文件读取失败
确认:
- 文件路径正确
- 文件格式为 `.xlsx` 或 `.xls`
- 文件没有被其他程序占用

### 问题 3: 字段映射错误
确认 Excel 文件的列名与上述表格完全一致(包括空格和标点符号)

## 数据验证建议

导入完成后,建议验证数据:

1. 检查总记录数
```sql
SELECT COUNT(*) FROM colleges;
```

2. 检查 985/211 院校数量
```sql
SELECT COUNT(*) FROM colleges WHERE is_985 = 1;
SELECT COUNT(*) FROM colleges WHERE is_211 = 1;
```

3. 检查省份分布
```sql
SELECT province, COUNT(*) as count FROM colleges GROUP BY province ORDER BY count DESC;
```

## 技术支持

如遇到问题,请查看:
- 导入日志中的错误详情
- 数据库日志
- 联系技术支持团队
